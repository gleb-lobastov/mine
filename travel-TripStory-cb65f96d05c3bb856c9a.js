(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1129:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(72),o=n(202),c=n(916),l=n(30),u=n(883),s=n(183),d=n(819),I=Object(d.a)(function(e){return{group:{backgroundColor:"white",top:0,position:"sticky","&:not(:first-of-type)":{marginTop:e.spacing(5)},"& ~ $subgroup":{marginTop:e.spacing(2)},"& + $subgroup ":{marginTop:0}},subgroup:{backgroundColor:"white",position:"sticky",top:38},detail:{color:"gray",fontSize:12},formControl:{width:"100%"},ratingBlock:{display:"inline-flex",alignItems:"center"},ratingIcon:{color:"gray",fontSize:12}}});function E(e){var t=e.country,n=(t=void 0===t?{}:t).countryName,r=e.isSubgroup,i=e.isDetail,c=e.className,l=e.children,u=I();return i?a.a.createElement("span",{className:c},n):a.a.createElement(o.a,{variant:r?"h5":"h4",className:r?u.subgroup:u.group},n," ",l)}var v="group",O={LOCATIONS:"loc",COUNTRIES:"c",YEARS:"yr",YEARS_COUNTRIES:"yr_c",COUNTRIES_YEARS:"c_yr",TRIPS:"t",TRIPS_COUNTRIES:"t_с"},m="sort",N={RATING_ALPHABET:"r_a",VISITS_ALPHABET:"v_a",ALPHABET:"a"},f={VISIT:{ARRIVAL_YEAR:"ARRIVAL_YEAR"},TRIP:{DEPARTURE_TIME:"TRIP_DEPARTURE_DATE",ID:"TRIP_ID"},COUNTRY:{VISITS:"COUNTRY_VISITS",RATING:"COUNTRY_RATING",NAME_ID:"COUNTRY_NAME_ID"},LOCATION:{VISITS:"LOCATION_VISITS",RATING:"LOCATION_RATING",NAME_ID:"LOCATION_NAME_ID"}};function R(e,t){return"t".concat(e,"_c").concat(t)}function T(e,t){return"y".concat(e,"_c").concat(t)}function A(e){var t,n,r,i,o,c,l=e.visit,u=l.tripId,s=l.visitId,d=l.countryId,I=e.changes,v=I.isTripChanged,m=I.isCountryChanged,N=e.provision.countriesDict,f=e.groupBy,A=e.year,g=e.counters,p=e.classes,C=f===O.TRIPS_COUNTRIES,_=f===O.YEARS_COUNTRIES;if(!(m||C&&v))return null;var y=0;switch(f){case O.COUNTRIES:y=Object.keys((null==g?void 0:null===(t=g.countries)||void 0===t?void 0:null===(n=t[d])||void 0===n?void 0:n.locations)||{}).length;break;case O.COUNTRIES_YEARS:case O.YEARS_COUNTRIES:y=Object.keys((null==g?void 0:null===(r=g.yearsCountries)||void 0===r?void 0:null===(i=r[T(A,d)])||void 0===i?void 0:i.locations)||{}).length;break;case O.TRIPS_COUNTRIES:y=Object.keys((null==g?void 0:null===(o=g.tripsCountries)||void 0===o?void 0:null===(c=o[R(u,d)])||void 0===c?void 0:c.locations)||{}).length}return a.a.createElement(E,{key:"c".concat(d,"_v").concat(s),country:N[d],isSubgroup:C||_},y>2&&a.a.createElement("span",{className:p.detail},"".concat(y," мест")))}var g=n(1062),p=n.n(g),C=n(1063),_=n.n(C),y=n(1064),b=n.n(y);function S(e){var t=e.children,n=e.location,r=(n=void 0===n?{}:n).locationName;return a.a.createElement(o.a,null,r," ",t)}var h=n(254),L=null,P=null;function D(e,t,n,r){var a=e[t];a||(a=e[t]={});var i=a[n];i||(i=a[n]={});var o=i[r]||0;i[r]=o+1}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.countries,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}var U=[O.LOCATIONS,O.YEARS,O.TRIPS],G=[O.LOCATIONS,O.COUNTRIES];function B(e){var t=e.visit,n=e.visit,r=n.visitId,i=n.locationId,o=n.countryId,c=e.classes,l=e.changes,u=l.isYearChanged,s=l.isCountryChanged,d=l.isTripChanged,I=l.isLocationChanged,v=e.year,m=e.provision,f=m.locationsDict,R=m.locationsRating,T=m.countriesDict,A=e.groupBy,g=e.sortBy,C=e.counters;if(!(A===O.TRIPS||d||u||s||I))return null;var y=U.includes(A)?a.a.createElement(E,{country:T[o],className:c.detail,isDetail:!0}):null,L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=e.locationId;switch(r){case O.LOCATIONS:case O.COUNTRIES:return j(t,a);case O.YEARS:case O.COUNTRIES_YEARS:case O.YEARS_COUNTRIES:return function(e,t,n){var r=e.years,a=(r=void 0===r?{}:r)[n],i=(a=void 0===a?{}:a).locations;return(i=void 0===i?{}:i)[t]}(t,a,n);case O.TRIPS_COUNTRIES:}}(t,C,v,A),P=L>1?a.a.createElement("span",{className:c.detail},"".concat(L," визитов")):null,D=G.includes(A)?a.a.createElement("span",{className:c.detail},"в ".concat(function(e,t){var n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).years,i=void 0===a?{}:a;return Object.keys(i)}(C,i).join(", "))):null,Y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).reduce(function(e,t,n){return n>0&&e.push(a.a.createElement("span",null," ")),e.push(t),e},[])}(g===N.RATING_ALPHABET?function(e){var t=e.locationRating,n=e.classes;return a.a.createElement("div",{className:n.ratingBlock},function(e){var t=e.locationRating,n=e.classes;switch(t){case h.LOCATION_RATING.PLACE_TO_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}));case h.LOCATION_RATING.FEW_PER_YEAR:case h.LOCATION_RATING.ONCE_PER_YEAR:return a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}));case h.LOCATION_RATING.ONCE_PER_TWO_YEARS:case h.LOCATION_RATING.ONCE_PER_FIVE_YEARS:return a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}));case h.LOCATION_RATING.ONCE_PER_DECADE:case h.LOCATION_RATING.TWICE_PER_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,{className:n.ratingIcon}),a.a.createElement(p.a,{className:n.ratingIcon}));case h.LOCATION_RATING.ONCE_PER_LIVE:return a.a.createElement(p.a,{className:n.ratingIcon});case h.LOCATION_RATING.NEVER:return a.a.createElement(_.a,{className:n.ratingIcon});default:return a.a.createElement(b.a,{className:n.ratingIcon})}}({locationRating:t,classes:n}))}({classes:c,locationRating:null==R?void 0:R[i]}):null,y,P,D);return a.a.createElement(S,{key:"l".concat(i,"_v").concat(r),location:f[i],country:T[o]},Y)}function w(e){var t=e.trip,n=(t=void 0===t?{}:t).tripName,r=I();return a.a.createElement(o.a,{variant:"h4",className:r.group,paragraph:!0},n)}function V(e){var t=e.visit,n=t.visitId,r=t.tripId,i=e.changes.isTripChanged,o=e.provision.tripsDict;return i?a.a.createElement(w,{key:"t".concat(r,"_v").concat(n),trip:o[r]}):null}function k(e){var t=e.year,n=e.isSubgroup,r=I();return a.a.createElement(o.a,{variant:n?"h5":"h4",className:n?r.subgroup:r.group},t)}function M(e){var t=e.visit.visitId,n=e.changes,r=n.isYearChanged,i=n.isCountryChanged,o=e.groupBy,c=e.year,l=o===O.COUNTRIES_YEARS;return r||l&&i?a.a.createElement(k,{key:"y".concat(c,"_v").concat(t),year:c,isSubgroup:l}):null}var F=n(822),x=n(823),q=n(1113),W=n(1137),H=n(1130),z=n(1116),K=n(184);function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J,$=function(e,t){var n=t.groupBy,r=t.sortBy,i=I();Object(K.b)(function(t){var o=t.closeSidebar;return a.a.createElement(F.a,null,a.a.createElement(x.a,null,a.a.createElement(q.a,{className:i.formControl},a.a.createElement(W.a,{shrink:!0,id:"select-groupBy-filter-label"},"Сгруппировать"),a.a.createElement(H.a,{labelId:"select-groupBy-filter-label",autoWidth:!0,id:"select-groupBy-filter",value:n,onChange:function(t){o(),e(Z({},v,t.target.value))}},a.a.createElement(z.a,{value:O.LOCATIONS},"По городам"),a.a.createElement(z.a,{value:O.COUNTRIES},"По странам"),a.a.createElement(z.a,{value:O.YEARS},"По годам"),a.a.createElement(z.a,{value:O.YEARS_COUNTRIES},"По годам и странам"),a.a.createElement(z.a,{value:O.COUNTRIES_YEARS},"По странам и годам"),a.a.createElement(z.a,{value:O.TRIPS},"По поездкам"),a.a.createElement(z.a,{value:O.TRIPS_COUNTRIES},"По поездкам и странам")))),n!==O.TRIPS&&a.a.createElement(x.a,null,a.a.createElement(q.a,{className:i.formControl},a.a.createElement(W.a,{shrink:!0,id:"select-sortBy-filter-label"},"Сортировать"),a.a.createElement(H.a,{labelId:"select-sortBy-filter-label",autoWidth:!0,id:"select-sortBy-filter",value:r,onChange:function(t){o(),e(Z({},m,t.target.value))}},a.a.createElement(z.a,{value:N.ALPHABET},"По алфавиту"),a.a.createElement(z.a,{value:N.VISITS_ALPHABET},"По числу посещений"),a.a.createElement(z.a,{value:N.RATING_ALPHABET},"По рейтингу")))))},[n,r])},Q=n(81),X=n.n(Q),ee=n(427),te=n.n(ee),ne=n(861),re=n.n(ne),ae=n(1065);function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=(ie(J={},f.VISIT.ARRIVAL_YEAR,function(){return function(e,t){var n=e.arrivalDateTime,r=t.arrivalDateTime;return n||r?n&&r?r.getFullYear()-n.getFullYear():n?-1:1:0}}),ie(J,f.COUNTRY.NAME_ID,function(e){var t=e.countriesDict;return function(e,n){var r=e.countryId,a=n.countryId,i=t[r]||{},o=i.countryName,c=t[a]||{},l=c.countryName;return o>l?1:l>o?-1:r-a}}),ie(J,f.COUNTRY.RATING,function(e){var t=e.locationsDict;return function(e,n){var r=e.countryId,a=n.countryId,i=ue(t);return i(r)-i(a)}}),ie(J,f.COUNTRY.VISITS,function(e,t){return function(e,n){var r=e.countryId,a=n.countryId;return Y(t,a)-Y(t,r)}}),ie(J,f.LOCATION.NAME_ID,function(){return function(e,t){var n=e.locationId,r=e.locationName,a=t.locationId,i=t.locationName;return r>i?1:i>r?-1:n-a}}),ie(J,f.LOCATION.RATING,function(e){var t=e.locationsRating;return function(e,n){var r=e.locationId,a=n.locationId,i=t[r],o=t[a];return i-o}}),ie(J,f.LOCATION.VISITS,function(e,t){return function(e,n){var r=e.locationId,a=n.locationId;return j(t,a)-j(t,r)}}),ie(J,f.TRIP.DEPARTURE_TIME,function(e){var t=e.tripsDict;return function(e,n){var r=e.tripId,a=n.tripId,i=t[r]||{},o=i.departureDateTime,c=t[a]||{},l=c.departureDateTime;return o||l?o&&l?l.getFullYear()-o.getFullYear():o?-1:1:0}}),ie(J,f.TRIP.ID,function(){return function(e,t){var n=e.tripId,r=t.tripId;return n-r}}),J);function ce(e,t){switch(e){case N.VISITS_ALPHABET:return null==t?void 0:t.VISITS;case N.RATING_ALPHABET:return null==t?void 0:t.RATING;default:return}}function le(e,t,n){var r=n.map(function(n){var r=oe[n];return X()(r,"missing comparatorKey: %s",n),r?r(e,t):null}).filter(Boolean);return function(e,t){for(var n=0;n<r.length;n+=1){var a=r[n](e,t);if(a)return a}return 0}}var ue=Object(ae.a)(function(e){return te()(function(t){var n=Object.values(e).filter(function(e){var n=e.countryId;return t===n}).map(function(e){return e.rating});return n.length?re()(n)/n.length:0})});function se(e){var t=e.match.params.userAlias,n=I(),r=Object(s.b)(),d=r.queryFilter,E=(d=void 0===d?{}:d)[v],g=void 0===E?O.LOCATIONS:E,p=d[m],C=void 0===p?N.ALPHABET:p,_=r.setQueryFilter;$(_,{groupBy:g,sortBy:C});var y=Object(u.a)({userAlias:t}),b=y.isPending,S=y.isError,h=y.updatesCounter,j=y.visitsIds,Y=y.visitsDict,U=y.tripsDict,G=y.locationsDict,w=y.locationsRating,k=y.countriesDict,F=Object(l.d)().travel.locations;if(S)return a.a.createElement("div",null,"...Error");if(b)return a.a.createElement("div",null,"...Loading");var x=j.map(function(e){return Y[e]}).filter(Boolean),q=function(e,t){if(t&&t===L)return P;var n={totalVisits:{},countries:{},years:{},trips:{},tripsCountries:{},yearsCountries:{},locations:{}};return e.forEach(function(e){var t,r=e.locationId,a=e.countryId,i=e.tripId,o=e.visitId,c=(t=e.arrivalDateTime)?t.getFullYear(t):null;D(n.countries,a,"visits",o),D(n.countries,a,"locations",r),D(n.countries,a,"years",c),D(n.countries,a,"trips",i),D(n.years,c,"locations",r),D(n.years,c,"countries",a),D(n.years,c,"trips",i),D(n.trips,i,"visits",o),D(n.trips,i,"locations",r),D(n.trips,i,"countries",a),D(n.locations,r,"visits",o),D(n.locations,r,"years",c),D(n.locations,r,"trips",i),D(n.tripsCountries,R(i,a),"locations",r),D(n.yearsCountries,T(c,a),"locations",r)},{}),L=t,P=n,n}(x,h),W=function(e,t,n){var r=e.groupBy,a=e.sortBy;switch(r){case O.TRIPS:return le(t,n,[f.TRIP.DEPARTURE_TIME,f.TRIP.ID,f.LOCATION.NAME]);case O.TRIPS_COUNTRIES:return le(t,n,[f.TRIP.DEPARTURE_TIME,f.TRIP.ID,ce(a,f.COUNTRY),f.COUNTRY.NAME_ID,ce(a,f.LOCATION),f.LOCATION.NAME_ID]);case O.COUNTRIES:return le(t,n,[ce(a,f.COUNTRY),f.COUNTRY.NAME_ID,ce(a,f.LOCATION),f.LOCATION.NAME_ID]);case O.YEARS:return le(t,n,[f.VISIT.ARRIVAL_YEAR,ce(a,f.LOCATION),f.LOCATION.NAME_ID]);case O.YEARS_COUNTRIES:return le(t,n,[f.VISIT.ARRIVAL_YEAR,ce(a,f.COUNTRY),f.COUNTRY.NAME_ID,ce(a,f.LOCATION),f.LOCATION.NAME_ID]);case O.COUNTRIES_YEARS:return le(t,n,[ce(a,f.COUNTRY),f.COUNTRY.NAME_ID,f.VISIT.ARRIVAL_YEAR,ce(a,f.LOCATION),f.LOCATION.NAME_ID]);case O.LOCATIONS:default:return le(t,n,[ce(a,f.LOCATION),f.LOCATION.NAME_ID])}}({groupBy:g,sortBy:C},{locationsDict:G,tripsDict:U,countriesDict:k,locationsRating:w},q),H=x.sort(W),z=H.reduce(function(e,t,r){var a=r>0?H[r-1]:{},i=a.countryId,o=a.locationId,c=a.tripId,l=t.countryId,u=t.locationId,s=t.tripId,d=de(a),I=de(t),E={changes:{isTripChanged:function(e){return e===O.TRIPS||e===O.TRIPS_COUNTRIES}(g)&&c!==s,isYearChanged:function(e){return e===O.YEARS||e===O.COUNTRIES_YEARS||e===O.YEARS_COUNTRIES}(g)&&d!==I,isCountryChanged:function(e){return e===O.TRIPS_COUNTRIES||e===O.COUNTRIES||e===O.COUNTRIES_YEARS||e===O.YEARS_COUNTRIES}(g)&&i!==l,isLocationChanged:o!==u},classes:n,counters:q,groupBy:g,sortBy:C,provision:y,visit:t,year:I};return function(e,t){var n=e.tripNode,r=e.countryNode,a=e.yearNode,i=e.locationNode;switch(t){case O.TRIPS:return[n,i];case O.TRIPS_COUNTRIES:return[n,r,i];case O.COUNTRIES:return[r,i];case O.YEARS:return[a,i];case O.YEARS_COUNTRIES:return[a,r,i];case O.COUNTRIES_YEARS:return[r,a,i];case O.LOCATIONS:default:return[i]}}({tripNode:V(E),countryNode:A(E),yearNode:M(E),locationNode:B(E)},g).filter(Boolean).forEach(function(t){e.push(t)}),e},[]),K=a.a.createElement(o.a,{variant:"h6",paragraph:!0},a.a.createElement("span",null,"Всего "),a.a.createElement(c.a,{to:F.toUrl({userAlias:t}),component:i.b},"".concat(Object.keys((null==q?void 0:q.locations)||{}).length," городов ")),a.a.createElement("span",null,"из "),a.a.createElement("span",null,"".concat(Object.keys((null==q?void 0:q.countries)||{}).length," стран ")));return a.a.createElement("div",null,K,z)}function de(e){var t=e.arrivalDateTime;return t?t.getFullYear(t):null}n.d(t,"default",function(){return se})},1133:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(1),c=n.n(o),l=n(1077),u=n.n(l),s=n(819),d=n(106),I=n(1113),E=n(1137),v=n(1130),O=n(1116),m=n(254);function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=(N(r={},m.LOCATION_RATING.PLACE_TO_LIVE,"Жил бы здесь"),N(r,m.LOCATION_RATING.FEW_PER_YEAR,"Несколько раз в год"),N(r,m.LOCATION_RATING.ONCE_PER_YEAR,"Раз в год"),N(r,m.LOCATION_RATING.ONCE_PER_TWO_YEARS,"Раз в пару лет"),N(r,m.LOCATION_RATING.ONCE_PER_FIVE_YEARS,"Раз в пять лет"),N(r,m.LOCATION_RATING.ONCE_PER_DECADE,"Раз в десятилетие"),N(r,m.LOCATION_RATING.TWICE_PER_LIVE,"Пару раз в жизни"),N(r,m.LOCATION_RATING.ONCE_PER_LIVE,"Раз в жизни"),N(r,m.LOCATION_RATING.NEVER,"Никогда"),r),R=Object(s.a)({formControl:{width:"100%"}});function T(e){var t=e.locationId,n=e.locationRating,r=e.isEditable,a=e.onSubmitLocationRating,o=R();return r?i.a.createElement(I.a,{className:o.formControl},i.a.createElement(E.a,{shrink:!0,id:"select-location-rating-label"},"Я бы ездил сюда"),i.a.createElement(v.a,{labelId:"select-location-rating-label",id:"select-location-rating",value:n,onChange:function(e){a(e,t,e.target.value)}},i.a.createElement(O.a,{value:m.LOCATION_RATING.PLACE_TO_LIVE},f[m.LOCATION_RATING.PLACE_TO_LIVE]),i.a.createElement(O.a,{value:m.LOCATION_RATING.FEW_PER_YEAR},f[m.LOCATION_RATING.FEW_PER_YEAR]),i.a.createElement(O.a,{value:m.LOCATION_RATING.ONCE_PER_YEAR},f[m.LOCATION_RATING.ONCE_PER_YEAR]),i.a.createElement(O.a,{value:m.LOCATION_RATING.ONCE_PER_TWO_YEARS},f[m.LOCATION_RATING.ONCE_PER_TWO_YEARS]),i.a.createElement(O.a,{value:m.LOCATION_RATING.ONCE_PER_FIVE_YEARS},f[m.LOCATION_RATING.ONCE_PER_FIVE_YEARS]),i.a.createElement(O.a,{value:m.LOCATION_RATING.ONCE_PER_DECADE},f[m.LOCATION_RATING.ONCE_PER_DECADE]),i.a.createElement(O.a,{value:m.LOCATION_RATING.TWICE_PER_LIVE},f[m.LOCATION_RATING.TWICE_PER_LIVE]),i.a.createElement(O.a,{value:m.LOCATION_RATING.ONCE_PER_LIVE},f[m.LOCATION_RATING.ONCE_PER_LIVE]),i.a.createElement(O.a,{value:m.LOCATION_RATING.NEVER},f[m.LOCATION_RATING.NEVER]))):i.a.createElement("div",null,f[n])}T.propTypes={locationRating:c.a.number,locationId:c.a.number.isRequired,isEditable:c.a.bool.isRequired,onSubmitLocationRating:c.a.func.isRequired},T.defaultProps={locationRating:null};var A=n(397),g=n.n(A),p=function(){var e=null,t=null;return{promise:new Promise(function(n,r){e=n,t=r}),resolver:e,rejector:t}},C=function(e){var t=Object(a.useMemo)(p,[]),n=t.promise,r=t.resolver,i=Object(a.useRef)(null),o=Object(a.useRef)(0);return Object(a.useEffect)(function(){g()(i,e)||(o.current+=1)}),Object(a.useEffect)(function(){var t=[];return n.then(function(n){var r=n.map,a=n.maps,i=new a.LatLngBounds;t=e.map(function(e){var t=e.lat,n=e.lon,o=new a.Marker({position:{lat:t,lng:n},map:r});return i.extend(o.position),o}),r.fitBounds(i),r.getZoom()>11&&r.setZoom(11)}),function(){return t.forEach(function(e){return e.setMap(null)})}},[o.current]),{handleGoogleApiLoaded:r}},_=(n(862),n(833)),y=n(863);n.d(t,"default",function(){return h});var b=Object(s.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},googleMapContainer:{margin:"12px 0",width:"800px",maxWidth:"100%",height:"400px",maxHeight:"100%"}}),S="travel.LocationsPage";function h(e){var t=e.match.params,n=t.userAlias,r=t.strLocationId,o=b(),c=Object(d.c)(),l=c.isAuthenticated,s=c.userAlias,I=function(e){var t=e.domain,n=e.userAlias,r=Object(_.a)({userAlias:n}),a=r.isError,i=r.isPending,o=r.locationsDict,c=r.locationsIds;return{isError:a,isPending:i,locationsDict:o,locationsIds:void 0===c?[]:c,locationsRating:r.locationsRating,submitLocationRating:Object(y.b)({domain:t}).submitLocationRating}}({domain:S,userAlias:n}),E=I.isError,v=I.isPending,O=I.locationsDict,m=I.locationsIds,N=I.locationsRating,f=I.submitLocationRating,R=parseInt(r,10),A=R?[R]:m,g=Object(a.useCallback)(function(e,t,n){f({query:{rating:n,id:String(t)},condition:Boolean(t)})}),p=C(A.map(function(e){return O[e]})).handleGoogleApiLoaded;if(E)return i.a.createElement("div",null,"...Error");if(v)return i.a.createElement("div",null,"...Loading");if(R&&!m.includes(R))return i.a.createElement("div",null,"Путешественик ".concat(n," еще не посетил данную локацию"));var h=l&&s===n;return i.a.createElement("div",{className:o.container},i.a.createElement("div",{className:o.googleMapContainer},i.a.createElement(u.a,{bootstrapURLKeys:{key:"AIzaSyCvP0e64ui7WpXKBdzOyEmkb4l5RuGy3Zs"},center:{lat:0,lng:0},zoom:11,onGoogleApiLoaded:p})),A.map(function(e){var t=O[e];if(!t)return null;var n=t.locationName;return i.a.createElement(i.a.Fragment,{key:e},i.a.createElement("h1",{className:o.location},n),i.a.createElement(T,{locationId:e,locationRating:N[e],isEditable:h,onSubmitLocationRating:g}))}))}h.propTypes={match:c.a.shape({params:c.a.shape({userAlias:c.a.string.isRequired,strLocationId:c.a.string}).isRequired}).isRequired}},1142:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(1),o=n.n(i),c=n(19),l=n(292),u=n.n(l),s=n(9),d=n(211),I=n(129),E=n(836),v=n(203),O=n(207),m=n(846),N=n(204),f=Object(d.a)(m.c),R=function(e){var t=e.classes,n=e.visits,r=(n=void 0===n?{}:n).data,i=void 0===r?[]:r,o=e.ridesDict;if(!o||!i)return a.a.createElement("div",null,"None");var c=a.a.createElement("div",null,"Заметки о поездке не найдены");if(!i.length)return c;var l=i.length-1,u=f(i).map(function(e,n){var r,i=e.visitId,c=e.arrivalRideId,u=e.departureRideId,s=e.visitComment,d=e.locationName,I=(o[c]||{}).rideComment;l===n&&(r=(o[u]||{}).rideComment);return I||r||s?a.a.createElement("article",{key:"id".concat(i),className:t.visitContainer},a.a.createElement("h1",{className:t.location},d),Boolean(I)&&a.a.createElement("section",{className:t.storyPart},I),Boolean(s)&&a.a.createElement("section",{className:t.storyPart},s),Boolean(r)&&a.a.createElement("section",{className:t.storyPart},r)):null}),s=u.some(Boolean)?u:c;return a.a.createElement("div",{className:t.container},s)};R.propTypes={classes:o.a.objectOf(o.a.string).isRequired,trips:o.a.shape({data:o.a.arrayOf(o.a.shape(O.default))}).isRequired,visits:o.a.shape({data:o.a.arrayOf(o.a.shape(N.default))}).isRequired,ridesDict:o.a.objectOf(o.a.shape(v.default)).isRequired};t.default=u()(c.g,Object(s.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},storyPart:{margin:"12px 0"}}),Object(E.a)(function(e,t){var n,r,a=t.match.params.strTripId,i=(n=a,r=Number(n),Number.isNaN(r)?NaN:parseFloat(n));return{identity:{strTripId:a},request:{rides:{modelName:"rides",query:{filter:{trip_id:{comparator:"=",value:i}},navigation:{isDisabled:!0}}},visits:{modelName:"visits",query:{filter:{trip_id:{comparator:"=",value:i}},navigation:{isDisabled:!0}}}},domain:"tripStoryPage"}},function(e){return{ridesDict:Object(I.d)(e,"rides")}}))(R)},833:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(58),a=n(884),i=n.n(a),o=n(886),c=n.n(o),l=n(861),u=n.n(l),s=n(129),d=n(10),I=n(862),E=n(838),v=n(863);function O(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function m(e){var t=e.userAlias,n=function(e){var t=e.userAlias;return Object(s.i)({domain:"travel.trips-".concat(t),isProvision:!0,modelName:"trips",observe:t,query:{userAlias:t,navigation:{isDisabled:!0}}})}({userAlias:t}),a=Object(I.a)({domain:"travel.trips-".concat(t,".user"),userAlias:t}),i=a.user,o=(i=void 0===i?{}:i).locationsRating,c=void 0===o?{}:o,l=O(a,["user"]),m=(Object(d.o)(n)||{}).data,f=void 0===m?[]:m,R=Object(r.d)(function(e){return{tripsDict:Object(s.d)(e,"trips")||{},visitsDict:Object(s.d)(e,"visits")||{},ridesDict:Object(s.d)(e,"rides")||{},countriesDict:Object(s.d)(e,"countries")||{},locationsDict:Object(s.d)(e,"locations")||{}}}),T=R.tripsDict,A=R.visitsDict,g=R.ridesDict,p=R.countriesDict,C=R.locationsDict,_=Array.from(new Set(f.flatMap(function(e){var t;return(null===(t=T[e])||void 0===t?void 0:t.visits)||[]}))),y=Array.from(new Set(f.flatMap(function(e){var t;return(null===(t=T[e])||void 0===t?void 0:t.rides)||[]}))),b=Array.from(new Set(_.flatMap(function(e){var t;return(null===(t=A[e])||void 0===t?void 0:t.countryId)||[]}))),S=Array.from(new Set(_.flatMap(function(e){var t;return(null===(t=A[e])||void 0===t?void 0:t.locationId)||[]}))),h=Object(E.a)(),L=Object(v.a)({domain:"travel.locations-".concat(t),locationsIds:S}),P=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{updatesCounter:u()(t.map(d.p)),isReady:t.every(d.i),isPending:t.some(d.h),isValid:t.every(d.k),error:t.find(d.g),errors:t.map(d.f).filter(Boolean)}}(n,l,h,L);return{tripsProvision:n,countriesProvision:h,locationsProvision:L,isError:P.isError,isValid:P.isValid,isReady:P.isReady,isPending:P.isPending,tripsIds:f,tripsDict:T,visitsIds:_,visitsDict:A,ridesIds:y,ridesDict:g,ridesStats:N(y,g),locationsIds:S,locationsDict:C,locationsRating:c,countriesIds:b,countriesDict:p}}function N(e,t){return{earliestDeparture:new Date(c()(e.map(function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.departureDateTime.getTime()}))),latestArrival:new Date(i()(e.map(function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.arrivalDateTime.getTime()})))}}},836:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(294),o=function(e){return function(t){var n=t.provision,r=(n=void 0===n?{}:n).isPending,o=void 0===r||r,c=n.hasFallback;return o&&!c?a.a.createElement(i.a,null):a.a.createElement(e,t)}},c=n(129);t.a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}}(c.a.apply(void 0,t),o)(e)}}},838:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(129),a=n(10);function i(){var e=Object(r.i)({domain:"travel.countries",isProvision:!0,modelName:"countries",query:{navigation:{isDisabled:!0}}}),t=(Object(a.o)(e)||{}).data;return{countriesIds:void 0===t?[]:t,isReady:Object(a.i)(e),isLoading:Object(a.h)(e),isError:Object(a.g)(e),counters:e.counters}}},846:function(e,t,n){"use strict";var r=n(844),a=n.n(r),i=n(145),o=n.n(i),c=n(851),l=n.n(c),u=function(e,t){var n=t.maxLength,r=t.separator,a=void 0===r?", ":r,i=l()(e),o=i.slice(0,n).join(a);return i.length>n?"".concat(o,"..."):o},s=n(210),d=function(e,t,n,r){if(!e.length)return r;var i=Object.keys(a()(e.filter(function(e){return e.visitType!==s.VISIT_TYPES.TRANSIT}),"countryId"));return 1===i.length?u(e.map(function(e){return e.locationName}),{maxLength:4})||r:u(i.map(function(e){return Number(e)!==n&&t[e]&&t[e].countryName}).filter(Boolean),{maxLength:4})||r};n.d(t,"c",function(){return I}),n.d(t,"a",function(){return E}),n.d(t,"b",function(){return d});var I=function(e){return e.sort(function(e,t){return e.orderInTrip-t.orderInTrip})},E=function(e){return o()(a()(e,"tripId"),I)}},862:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(58),a=n(129);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){var t=e.domain,n=e.userAlias,o=Object(r.d)(function(e){return Object(a.f)(e,"users",n)});return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){i(e,t,n[t])})}return e}({},Object(a.i)({domain:t,applicableSchemaName:"item",isProvision:!0,modelName:"users",observe:n,condition:Boolean(n),query:{id:n}}),{user:o})}},863:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return u});var r=n(58),a=n(129),i=n(10);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e){var t=e.domain,n=e.locationsIds,o=Object(r.d)(function(e){return Object(a.d)(e,"locations")||{}}),c=n.filter(function(e){return!o[e]}),l=Object(a.i)({domain:t,isProvision:!0,modelName:"locations",observe:n,condition:Boolean(c.length),query:{filter:{id:{comparator:"in",value:c}},navigation:{isDisabled:!0}}});return{locationsDict:o,isReady:Object(i.i)(l),isLoading:Object(i.h)(l),isError:Object(i.g)(l),counters:l.counters}}function u(e){var t=e.domain,n=c(Object(a.j)({domain:t,modelName:"locations",method:"POST"}),2),r=n[0];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}({},n[1],{submitLocationRating:r})}},883:function(e,t,n){"use strict";var r=n(833);n.d(t,"a",function(){return r.a});n(838)}}]);
//# sourceMappingURL=travel-TripStory-cb65f96d05c3bb856c9a.js.map