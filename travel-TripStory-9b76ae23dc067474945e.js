(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1081:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(35),o=n(808),c=n(201),u=n(130),l=n(909),s=n(783),E=Object(s.a)((function(e){return{visibilityTrigger:{"&:hover $visibleOnlyOnHover":{visibility:"visible"}},visibleOnlyOnHover:{visibility:"hidden"},group:{backgroundColor:"white",top:0,"&:not(:first-of-type)":{marginTop:e.spacing(5)},"& ~ $subgroup":{marginTop:e.spacing(2)},"& + $subgroup ":{marginTop:0}},subgroup:{backgroundColor:"white",top:38},detail:{color:"gray",fontSize:12},formControl:{width:"100%"},ratingBlock:{display:"inline-flex",alignItems:"center"},ratingIcon:{color:"gray",fontSize:12},halfDown:{position:"relative",top:12}}})),d=n(787),O=n(788),f=n(1065),v=n(1087),I=n(1082),b=n(1068),m=n(202),p=n(303);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var y=function(e,t,n){var r=E(),i=t||{},o=i[p.d],c=function(e){return Object.values(p.f).includes(e)?e:p.g}(i[p.e]),u=T(function(e,t){var n=Object.values(p.h).includes(t)?t:p.j,r=p.i[n]||[];return[r.find((function(t){return t.key===e}))?e:p.c[n],r]}(o,n),2),l=u[0],s=u[1];return Object(m.b)((function(t){var n=t.closeSidebar;return a.a.createElement(d.a,null,a.a.createElement(O.a,null,a.a.createElement(f.a,{className:r.formControl},a.a.createElement(v.a,{shrink:!0,id:"select-groupBy-filter-label"},"Сгруппировать"),a.a.createElement(I.a,{labelId:"select-groupBy-filter-label",autoWidth:!0,id:"select-groupBy-filter",value:l,onChange:function(t){n(),e(g({},p.d,t.target.value))}},s.map((function(e){return a.a.createElement(b.a,{key:e.key,value:e.key},e.l10n)}))))),l!==p.b.TRIPS&&a.a.createElement(O.a,null,a.a.createElement(f.a,{className:r.formControl},a.a.createElement(v.a,{shrink:!0,id:"select-sortBy-filter-label"},"Сортировать"),a.a.createElement(I.a,{labelId:"select-sortBy-filter-label",autoWidth:!0,id:"select-sortBy-filter",value:c,onChange:function(t){n(),e(g({},p.e,t.target.value))}},a.a.createElement(b.a,{value:p.f.ALPHABET},"По алфавиту"),a.a.createElement(b.a,{value:p.f.VISITS_ALPHABET},"По числу посещений"),a.a.createElement(b.a,{value:p.f.RATING_ALPHABET},"По рейтингу")))))}),[l,c]),{groupBy:l,sortBy:c}};var R=n(93),A=n.n(R),N=n(422),C=n.n(N),_=n(810),h=n.n(_),S=n(1021);function P(e,t){return"t".concat(e,"_c").concat(t)}function j(e,t){return"y".concat(e,"_c").concat(t)}function L(e){var t=e.arrivalDateTime;return t?t.getFullYear(t):null}function D(e){return e===p.b.TRIPS||e===p.b.TRIPS_COUNTRIES}var Y,w=null,V=null;function B(e,t,n,r){var a=e[t];a||(a=e[t]={});var i=a[n];i||(i=a[n]={});var o=i[r]||0;i[r]=o+1}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.countries,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}function k(e,t,n){var r=e.years,a=(r=void 0===r?{}:r)[n],i=(a=void 0===a?{}:a).locations;return(i=void 0===i?{}:i)[t]}function M(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=(H(Y={},p.a.VISIT.ARRIVAL_YEAR,(function(){return function(e,t){var n=e.arrivalDateTime,r=t.arrivalDateTime;return n||r?n&&r?r.getFullYear()-n.getFullYear():n?-1:1:0}})),H(Y,p.a.COUNTRY.NAME_ID,(function(e){var t=e.countriesDict;return function(e,n){var r=e.countryId,a=n.countryId,i=(t[r]||{}).countryName,o=(t[a]||{}).countryName;return i>o?1:o>i?-1:r-a}})),H(Y,p.a.COUNTRY.RATING,(function(e){var t=e.countriesRating;return function(e,n){var r=e.countryId,a=n.countryId;return(t[r]||10)-(t[a]||10)}})),H(Y,p.a.COUNTRY.VISITS,(function(e,t){return function(e,n){var r=e.countryId,a=n.countryId;return G(t,a)-G(t,r)}})),H(Y,p.a.LOCATION.NAME_ID,(function(){return function(e,t){var n=e.locationId,r=e.locationName,a=t.locationId,i=t.locationName;return r>i?1:i>r?-1:n-a}})),H(Y,p.a.LOCATION.RATING,(function(e){var t=e.locationsRating;return function(e,n){var r=e.locationId,a=n.locationId;return(t[r]||10)-(t[a]||10)}})),H(Y,p.a.LOCATION.VISITS,(function(e,t){return function(e,n){var r=e.locationId,a=n.locationId;return U(t,a)-U(t,r)}})),H(Y,p.a.TRIP.DEPARTURE_TIME,(function(e){var t=e.tripsDict;return function(e,n){var r=e.tripId,a=n.tripId,i=(t[r]||{}).departureDateTime,o=(t[a]||{}).departureDateTime;return i||o?i&&o?o.getFullYear()-i.getFullYear():i?-1:1:0}})),H(Y,p.a.TRIP.ID,(function(){return function(e,t){return e.tripId-t.tripId}})),Y);function x(e,t){switch(e){case p.f.VISITS_ALPHABET:return[null==t?void 0:t.VISITS];case p.f.RATING_ALPHABET:return[null==t?void 0:t.RATING,null==t?void 0:t.VISITS];default:return[]}}function W(e,t,n){var r=n.map((function(n){var r=F[n];return A()(r,"missing comparatorKey: %s",n),r?r(e,t):null})).filter(Boolean);return function(e,t){for(var n=0;n<r.length;n+=1){var a=r[n](e,t);if(a)return a}return 0}}Object(S.a)((function(e){return C()((function(t){var n=Object.values(e).filter((function(e){var n=e.countryId;return t===n})).map((function(e){return e.rating}));return n.length?h()(n)/n.length:0}))}));var q=n(228);function z(e){var t=e.country,n=(t=void 0===t?{}:t).countryName,r=e.isSubgroup,i=e.isDetail,o=e.className,c=e.children,u=E();return i?a.a.createElement("span",{className:o},n):a.a.createElement(q.a,{variant:r?"h5":"h4",className:r?u.subgroup:u.group},n," ",c)}function K(e){var t,n,r,i,o,c,u=e.visit,l=u.tripId,s=u.visitId,E=u.countryId,d=e.changes,O=d.isTripChanged,f=d.isCountryChanged,v=e.provision.countriesDict,I=e.groupBy,b=e.year,m=e.counters,g=e.classes,T=I===p.b.TRIPS_COUNTRIES,y=I===p.b.YEARS_COUNTRIES;if(!(f||T&&O))return null;var R=0;switch(I){case p.b.COUNTRIES:R=Object.keys((null==m?void 0:null===(t=m.countries)||void 0===t?void 0:null===(n=t[E])||void 0===n?void 0:n.locations)||{}).length;break;case p.b.COUNTRIES_YEARS:case p.b.YEARS_COUNTRIES:R=Object.keys((null==m?void 0:null===(r=m.yearsCountries)||void 0===r?void 0:null===(i=r[j(b,E)])||void 0===i?void 0:i.locations)||{}).length;break;case p.b.TRIPS_COUNTRIES:R=Object.keys((null==m?void 0:null===(o=m.tripsCountries)||void 0===o?void 0:null===(c=o[P(l,E)])||void 0===c?void 0:c.locations)||{}).length}return a.a.createElement(z,{key:"c".concat(E,"_v").concat(s),country:v[E],isSubgroup:T||y},R>2&&a.a.createElement("span",{className:g.detail},"".concat(R," мест")))}var J=n(1069),Z=n(1022),$=n.n(Z),X=n(1023),Q=n.n(X),ee=n(1024),te=n.n(ee),ne=n(811),re=n(824),ae=Object(s.a)({autoMargin:{marginLeft:"auto"}});function ie(e){var t=e.children,n=e.shouldJustifyContent,r=e.location,i=(r=void 0===r?{}:r).locationName,o=ae(),c=a.a.Children.toArray(t);if(!n||c.length<=1)return a.a.createElement(q.a,null,i," ",t);var u=c.slice(-1),l=c.slice(0,-1);return a.a.createElement(J.a,{container:!0,justify:"space-between",alignItems:"center"},a.a.createElement(J.a,{item:!0},a.a.createElement(q.a,null,i," ",l)),a.a.createElement(J.a,{item:!0,classes:{item:o.autoMargin}},u))}var oe=n(276),ce=[p.b.LOCATIONS,p.b.YEARS,p.b.TRIPS],ue=[p.b.LOCATIONS,p.b.COUNTRIES];function le(e){var t=e.visit,n=e.visit,r=n.visitId,i=n.locationId,o=n.countryId,c=n.departureRideId,u=e.classes,l=e.changes,s=l.isYearChanged,E=l.isCountryChanged,d=l.isTripChanged,O=l.isLocationChanged,f=e.year,v=e.provision,I=v.locationsDict,b=v.locationsRating,m=v.countriesDict,g=v.visitsDict,T=v.ridesDict,y=e.groupBy,R=e.sortBy,A=e.counters,N=y===p.b.TRIPS;if(!(N||d||s||E||O))return null;var C=ce.includes(y)?a.a.createElement(z,{country:m[o],className:u.detail,isDetail:!0}):null,_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=e.locationId;switch(r){case p.b.LOCATIONS:case p.b.COUNTRIES:return U(t,a);case p.b.YEARS:case p.b.COUNTRIES_YEARS:case p.b.YEARS_COUNTRIES:return k(t,a,n);case p.b.TRIPS_COUNTRIES:}}(t,A,f,y),h=R!==p.f.RATING_ALPHABET&&_>1?a.a.createElement("span",{className:u.detail},"".concat(_," визитов")):null,S=R!==p.f.RATING_ALPHABET&&ue.includes(y)?a.a.createElement("span",{className:u.detail},"в ".concat(function(e,t){var n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).years,i=void 0===a?{}:a;return Object.keys(i)}(A,i).join(", "))):null,P=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).reduce((function(e,t,n){return n>0&&e.push(a.a.createElement("span",null," ")),e.push(t),e}),[])}(C,R===p.f.RATING_ALPHABET?function(e){var t=e.locationRating,n=e.classes;return a.a.createElement("div",{className:n.ratingBlock},function(e){var t=e.locationRating,n=e.classes;switch(t){case oe.LOCATION_RATING.PLACE_TO_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}));case oe.LOCATION_RATING.FEW_PER_YEAR:case oe.LOCATION_RATING.ONCE_PER_YEAR:return a.a.createElement(a.a.Fragment,null,a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}));case oe.LOCATION_RATING.ONCE_PER_TWO_YEARS:case oe.LOCATION_RATING.ONCE_PER_FIVE_YEARS:return a.a.createElement(a.a.Fragment,null,a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}));case oe.LOCATION_RATING.ONCE_PER_DECADE:case oe.LOCATION_RATING.TWICE_PER_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement($.a,{className:n.ratingIcon}),a.a.createElement($.a,{className:n.ratingIcon}));case oe.LOCATION_RATING.ONCE_PER_LIVE:return a.a.createElement($.a,{className:n.ratingIcon});case oe.LOCATION_RATING.NEVER:return a.a.createElement(Q.a,{className:n.ratingIcon});default:return a.a.createElement(te.a,{className:n.ratingIcon})}}({locationRating:t,classes:n}))}({classes:u,locationRating:null==b?void 0:b[i]}):null,h,S);return a.a.createElement(ie,{key:"l".concat(i,"_v").concat(r),location:I[i],country:m[o],shouldJustifyContent:N},P,N&&a.a.createElement(J.a,{container:!0},a.a.createElement(J.a,{item:!0},a.a.createElement(q.a,{className:u.detail},Object(ne.b)(g[r]))),a.a.createElement(J.a,{item:!0},a.a.createElement(re.a,{ride:T[c],className:u.halfDown}))))}var se=[p.b.LOCATIONS,p.b.YEARS,p.b.TRIPS];function Ee(e){var t=e.keyBase,n=e.children,r=e.classes,i=e.visit.tripId,o=e.provision,c=o.tripsDict,u=o.locationsDict,l=o.countriesDict,s=e.groupBy,E=c[i];if(!E)return null;var d=E.originLocationId,O=u[d];if(!O)return null;var f=O.countryId,v=se.includes(s)?a.a.createElement(z,{country:l[f],className:r.detail,isDetail:!0}):null;return a.a.createElement(ie,{key:"".concat(t,"_t").concat(i,"_ol").concat(d),location:u[d],country:l[f],shouldJustifyContent:null!=n},v,n)}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(e){var t=e.visit.arrivalRideId,n=e.classes,r=e.changes.isTripChanged,i=e.provision.ridesDict;return r?Ee(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){Oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{keyBase:"dl",children:a.a.createElement(re.a,{ride:i[t],className:n.halfDown})})):null}function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function be(e){return e.changes.willTripChange?Ee(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{keyBase:"al"})):null}var me=n(792),pe=n(908),ge=n.n(pe);function Te(e){var t=e.trip,n=(t=void 0===t?{}:t).tripName,r=e.children,i=e.className;return a.a.createElement(q.a,{variant:"h4",className:i,paragraph:!0},a.a.createElement("span",null,n),r)}function ye(e){var t=e.visit,n=t.visitId,r=t.tripId,i=e.changes.isTripChanged,o=e.provision.tripsDict,c=e.travelPaths.tripEdit,u=e.hasEditRights,l=e.userAlias,s=e.classes;if(!i)return null;var E=u?a.a.createElement(me.a,{className:s.visibleOnlyOnHover,href:c.toUrl({userAlias:l,strTripId:String(r)}),size:"small"},a.a.createElement(ge.a,null)):null;return a.a.createElement(Te,{key:"t".concat(r,"_v").concat(n),className:s.visibilityTrigger,trip:o[r]},E)}function Re(e){var t=e.year,n=e.isSubgroup,r=E();return a.a.createElement(q.a,{variant:n?"h5":"h4",className:n?r.subgroup:r.group},t)}function Ae(e){var t=e.visit.visitId,n=e.changes,r=n.isYearChanged,i=n.isCountryChanged,o=e.groupBy,c=e.year,u=o===p.b.COUNTRIES_YEARS;return r||u&&i?a.a.createElement(Re,{key:"y".concat(c,"_v").concat(t),year:c,isSubgroup:u}):null}function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function he(e){var t=e.prevVisit,n=e.visit,r=e.nextVisit,a=e.groupBy,i=_e(e,["prevVisit","visit","nextVisit","groupBy"]),o=t.countryId,c=t.locationId,u=t.tripId,l=r.tripId,s=n.countryId,E=n.locationId,d=n.tripId,O=L(t),f=L(n),v=D(a),I=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){Ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({visit:n,groupBy:a,year:f,changes:{isTripChanged:v&&u!==d,willTripChange:v&&l!==d,isYearChanged:function(e){return e===p.b.YEARS||e===p.b.COUNTRIES_YEARS||e===p.b.YEARS_COUNTRIES}(a)&&O!==f,isCountryChanged:function(e){return e===p.b.TRIPS_COUNTRIES||e===p.b.COUNTRIES||e===p.b.COUNTRIES_YEARS||e===p.b.YEARS_COUNTRIES}(a)&&o!==s,isLocationChanged:c!==E}},i);switch(a){case p.b.TRIPS:return[ye(I),fe(I),le(I),be(I)];case p.b.TRIPS_COUNTRIES:return[ye(I),K(I),le(I)];case p.b.COUNTRIES:return[K(I),le(I)];case p.b.YEARS:return[Ae(I),le(I)];case p.b.YEARS_COUNTRIES:return[Ae(I),K(I),le(I)];case p.b.COUNTRIES_YEARS:return[K(I),Ae(I),le(I)];case p.b.LOCATIONS:default:return[le(I)]}}var Se=n(2),Pe=n.n(Se),je=n(83),Le=n(873);function De(e){var t=e.createTripUrl,n=e.locationsUrl,r=e.locationsCount,i=e.countriesCount,o=D(e.groupBy)?a.a.createElement("div",null,a.a.createElement(Le.a,{to:t,component:je.b},"Добавить поездку")):null;return a.a.createElement(q.a,{variant:"h6",paragraph:!0},a.a.createElement("span",null,"Всего "),a.a.createElement(Le.a,{to:n,component:je.b},"".concat(r," городов ")),a.a.createElement("span",null,"из "),a.a.createElement("span",null,"".concat(i," стран ")),o)}function Ye(e){var t=e.match.params,n=t.userAlias,r=t.section,s=Object(u.c)().userAlias,d=n===s,O=E(),f=Object(c.b)(),v=f.queryFilter,I=f.setQueryFilter,b=y(I,v,r),m=b.groupBy,g=b.sortBy,T=Object(o.a)({userAlias:n}),R=T.isPending,A=T.isError,N=Object(i.d)().travel,C=N.locations,_=N.tripCreate;if(A)return a.a.createElement("div",null,"...Error");if(R)return a.a.createElement("div",null,"...Loading");var h=T.visitsIds,S=T.visitsDict,D=h.map((function(e){return S[e]})).filter(Boolean),Y=function(e,t){if(t&&t===w)return V;var n={totalVisits:{},countries:{},years:{},trips:{},tripsCountries:{},yearsCountries:{},locations:{}};return e.forEach((function(e){var t=e.locationId,r=e.countryId,a=e.tripId,i=e.visitId,o=L(e);B(n.countries,r,"visits",i),B(n.countries,r,"locations",t),B(n.countries,r,"years",o),B(n.countries,r,"trips",a),B(n.years,o,"locations",t),B(n.years,o,"countries",r),B(n.years,o,"trips",a),B(n.trips,a,"visits",i),B(n.trips,a,"locations",t),B(n.trips,a,"countries",r),B(n.locations,t,"visits",i),B(n.locations,t,"years",o),B(n.locations,t,"trips",a),B(n.tripsCountries,P(a,r),"locations",t),B(n.yearsCountries,j(o,r),"locations",t)}),{}),w=t,V=n,n}(D,T.updatesCounter),U=De({locationsUrl:C.toUrl({userAlias:n}),createTripUrl:_.toUrl({userAlias:n}),locationsCount:Object.keys((null==Y?void 0:Y.locations)||{}).length,countriesCount:Object.keys((null==Y?void 0:Y.countries)||{}).length,groupBy:m}),G=T.locationsDict,k=T.locationsIds,H=a.a.createElement(l.a,{locationsDict:G,locationsIds:k,height:300}),F=D.sort(function(e,t,n){var r=e.groupBy,a=e.sortBy;switch(r){case p.b.TRIPS:return W(t,n,[p.a.TRIP.DEPARTURE_TIME,p.a.TRIP.ID,p.a.LOCATION.NAME]);case p.b.TRIPS_COUNTRIES:return W(t,n,[p.a.TRIP.DEPARTURE_TIME,p.a.TRIP.ID].concat(M(x(a,p.a.COUNTRY)),[p.a.COUNTRY.NAME_ID],M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]));case p.b.COUNTRIES:return W(t,n,[].concat(M(x(a,p.a.COUNTRY)),[p.a.COUNTRY.NAME_ID],M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]));case p.b.YEARS:return W(t,n,[p.a.VISIT.ARRIVAL_YEAR].concat(M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]));case p.b.YEARS_COUNTRIES:return W(t,n,[p.a.VISIT.ARRIVAL_YEAR].concat(M(x(a,p.a.COUNTRY)),[p.a.COUNTRY.NAME_ID],M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]));case p.b.COUNTRIES_YEARS:return W(t,n,[].concat(M(x(a,p.a.COUNTRY)),[p.a.COUNTRY.NAME_ID,p.a.VISIT.ARRIVAL_YEAR],M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]));case p.b.LOCATIONS:default:return W(t,n,[].concat(M(x(a,p.a.LOCATION)),[p.a.LOCATION.NAME_ID]))}}({groupBy:m,sortBy:g},T,Y)),q=F.reduce((function(e,t,r){return he({prevVisit:r>0?F[r-1]:{},visit:t,nextVisit:r<F.length-1?F[r+1]:{},provision:T,classes:O,counters:Y,groupBy:m,sortBy:g,hasEditRights:d,travelPaths:N,userAlias:n}).filter(Boolean).forEach((function(t){return e.push(t)})),e}),[U,H]);return a.a.createElement("div",{key:"".concat(m,"_").concat(g)},q)}De.propTypes={locationsUrl:Pe.a.string.isRequired,locationsCount:Pe.a.number.isRequired,countriesCount:Pe.a.number.isRequired},n.d(t,"default",(function(){return Ye}))},1084:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(2),c=n.n(o),u=n(783),l=n(130),s=n(909),E=n(1065),d=n(1087),O=n(1082),f=n(1068),v=n(276);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=(I(r={},v.LOCATION_RATING.PLACE_TO_LIVE,"Жил бы здесь"),I(r,v.LOCATION_RATING.FEW_PER_YEAR,"Несколько раз в год"),I(r,v.LOCATION_RATING.ONCE_PER_YEAR,"Раз в год"),I(r,v.LOCATION_RATING.ONCE_PER_TWO_YEARS,"Раз в пару лет"),I(r,v.LOCATION_RATING.ONCE_PER_FIVE_YEARS,"Раз в пять лет"),I(r,v.LOCATION_RATING.ONCE_PER_DECADE,"Раз в десятилетие"),I(r,v.LOCATION_RATING.TWICE_PER_LIVE,"Пару раз в жизни"),I(r,v.LOCATION_RATING.ONCE_PER_LIVE,"Раз в жизни"),I(r,v.LOCATION_RATING.NEVER,"Никогда"),r),m=Object(u.a)({formControl:{width:"100%"}});function p(e){var t=e.locationId,n=e.locationRating,r=e.isEditable,a=e.onSubmitLocationRating,o=m();return r?i.a.createElement(E.a,{className:o.formControl},i.a.createElement(d.a,{shrink:!0,id:"select-location-rating-label"},"Я бы ездил сюда"),i.a.createElement(O.a,{labelId:"select-location-rating-label",id:"select-location-rating",value:n,onChange:function(e){a(e,t,e.target.value)}},i.a.createElement(f.a,{value:v.LOCATION_RATING.PLACE_TO_LIVE},b[v.LOCATION_RATING.PLACE_TO_LIVE]),i.a.createElement(f.a,{value:v.LOCATION_RATING.FEW_PER_YEAR},b[v.LOCATION_RATING.FEW_PER_YEAR]),i.a.createElement(f.a,{value:v.LOCATION_RATING.ONCE_PER_YEAR},b[v.LOCATION_RATING.ONCE_PER_YEAR]),i.a.createElement(f.a,{value:v.LOCATION_RATING.ONCE_PER_TWO_YEARS},b[v.LOCATION_RATING.ONCE_PER_TWO_YEARS]),i.a.createElement(f.a,{value:v.LOCATION_RATING.ONCE_PER_FIVE_YEARS},b[v.LOCATION_RATING.ONCE_PER_FIVE_YEARS]),i.a.createElement(f.a,{value:v.LOCATION_RATING.ONCE_PER_DECADE},b[v.LOCATION_RATING.ONCE_PER_DECADE]),i.a.createElement(f.a,{value:v.LOCATION_RATING.TWICE_PER_LIVE},b[v.LOCATION_RATING.TWICE_PER_LIVE]),i.a.createElement(f.a,{value:v.LOCATION_RATING.ONCE_PER_LIVE},b[v.LOCATION_RATING.ONCE_PER_LIVE]),i.a.createElement(f.a,{value:v.LOCATION_RATING.NEVER},b[v.LOCATION_RATING.NEVER]))):i.a.createElement("div",null,b[n])}p.propTypes={locationRating:c.a.number,locationId:c.a.number.isRequired,isEditable:c.a.bool.isRequired,onSubmitLocationRating:c.a.func.isRequired},p.defaultProps={locationRating:null};n(802);var g=n(795),T=n(803);n.d(t,"default",(function(){return R}));var y=Object(u.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},googleMapContainer:{margin:"12px 0",width:"800px",maxWidth:"100%",height:"400px",maxHeight:"100%"}});function R(e){var t=e.match.params,n=t.userAlias,r=t.strLocationId,o=y(),c=Object(l.c)(),u=c.isAuthenticated,E=c.userAlias,d=function(e){var t=e.domain,n=e.userAlias,r=Object(g.a)({userAlias:n}),a=r.isError,i=r.isPending,o=r.locationsDict,c=r.locationsIds;return{isError:a,isPending:i,locationsDict:o,locationsIds:void 0===c?[]:c,locationsRating:r.locationsRating,submitLocationRating:Object(T.b)({domain:t}).submitLocationRating}}({domain:"travel.LocationsPage",userAlias:n}),O=d.isError,f=d.isPending,v=d.locationsDict,I=d.locationsIds,b=d.locationsRating,m=d.submitLocationRating,R=parseInt(r,10),A=R?[R]:I,N=Object(a.useCallback)((function(e,t,n){m({query:{rating:n,id:String(t)},condition:Boolean(t)})}));if(O)return i.a.createElement("div",null,"...Error");if(f)return i.a.createElement("div",null,"...Loading");if(R&&!I.includes(R))return i.a.createElement("div",null,"Путешественик ".concat(n," еще не посетил данную локацию"));var C=u&&E===n;return i.a.createElement("div",{className:o.container},i.a.createElement(s.a,{locationsDict:v,locationsIds:A}),A.map((function(e){var t=v[e];if(!t)return null;var n=t.locationName;return i.a.createElement(i.a.Fragment,{key:e},i.a.createElement("h1",{className:o.location},n),i.a.createElement(p,{locationId:e,locationRating:b[e],isEditable:C,onSubmitLocationRating:N}))})))}R.propTypes={match:c.a.shape({params:c.a.shape({userAlias:c.a.string.isRequired,strLocationId:c.a.string}).isRequired}).isRequired}},795:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(62),a=n(821),i=n.n(a),o=n(822),c=n.n(o),u=n(810),l=n.n(u),s=n(154),E=n.n(s),d=n(146),O=n(10),f=n(802),v=n(797),I=n(803);function b(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function m(e){var t=e.userAlias,n=function(e){var t=e.userAlias,n=e.tripsIds,a=Object(r.d)((function(e){return{tripsDict:Object(d.d)(e,"trips")||{}}})).tripsDict,i=!n,o=!i&&n.filter((function(e){return!a[e]}));return Object(d.g)({domain:"travel.trips-".concat(t),isProvision:!0,modelName:"trips",observe:t,query:{userAlias:t,navigation:{isDisabled:!0},filter:i?{}:{id:{comparator:"in",value:o}}}})}({userAlias:t,tripsIds:e.tripsIds}),a=Object(f.a)({domain:"travel.trips-".concat(t,".user"),userAlias:t}),o=a.user,c=(o=void 0===o?{}:o).locationsRating,u=void 0===c?{}:c,s=b(a,["user"]),m=(Object(O.o)(n)||{}).data,g=void 0===m?[]:m,T=Object(r.d)((function(e){return{tripsDict:Object(d.d)(e,"trips")||{},visitsDict:Object(d.d)(e,"visits")||{},ridesDict:Object(d.d)(e,"rides")||{},countriesDict:Object(d.d)(e,"countries")||{},locationsDict:Object(d.d)(e,"locations")||{}}})),y=T.tripsDict,R=T.visitsDict,A=T.ridesDict,N=T.countriesDict,C=T.locationsDict,_=Array.from(new Set(g.flatMap((function(e){var t;return(null===(t=y[e])||void 0===t?void 0:t.visits)||[]})))),h=Array.from(new Set(g.flatMap((function(e){var t;return(null===(t=y[e])||void 0===t?void 0:t.rides)||[]})))),S=Array.from(new Set(_.flatMap((function(e){var t;return(null===(t=R[e])||void 0===t?void 0:t.countryId)||[]})))),P=Array.from(new Set(_.flatMap((function(e){var t;return(null===(t=R[e])||void 0===t?void 0:t.locationId)||[]})))),j=Object(v.a)(),L=Object(I.a)({domain:"travel.locations-".concat(t),locationsIds:P}),D=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{updatesCounter:l()(t.map(O.p)),isReady:t.every(O.i),isPending:t.some(O.h),isValid:t.every(O.k),error:t.find(O.g),errors:t.map(O.f).filter(Boolean),invalidate:function(){return t.forEach((function(e){return(0,e.invalidate)()}))}}}(n,s,j,L),Y=D.isError,w=D.isValid,V=D.isReady,B=D.isPending,U=function(e,t,n){var r=e.reduce((function(e,r){var a=t[r];if(!a)return e;var i=n[r],o=a.countryId;return e[o]||(e[o]=[]),e[o].push(i),e}),{});return E()(r,(function(e){return function(e){if(!e.length)return 1/0;var t=e.length/e.map((function(e){return 1/e})).reduce((function(e,t){return e+t})),n=i()(e),r=Math.log(e.length);return 1/(1/t+r/n)}(e)}))}(P,C,u);return{tripsProvision:n,countriesProvision:j,locationsProvision:L,isError:Y,isValid:w,isReady:V,isPending:B,tripsIds:g,tripsDict:y,visitsIds:_,visitsDict:R,ridesIds:h,ridesDict:A,ridesStats:p(h,A),locationsIds:P,locationsDict:C,locationsRating:u,countriesIds:S,countriesDict:N,countriesRating:U}}function p(e,t){return{earliestDeparture:new Date(c()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.departureDateTime.getTime()})))),latestArrival:new Date(i()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.arrivalDateTime.getTime()}))))}}},797:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(146),a=n(10);function i(){var e=Object(r.g)({domain:"travel.countries",isProvision:!0,modelName:"countries",query:{navigation:{isDisabled:!0}}}),t=(Object(a.o)(e)||{}).data;return{countriesIds:void 0===t?[]:t,isReady:Object(a.i)(e),isLoading:Object(a.h)(e),isError:Object(a.g)(e),counters:e.counters}}},802:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(62),a=n(146);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=e.domain,n=e.userAlias,c=Object(r.d)((function(e){return Object(a.e)(e,"users",n)}));return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(a.g)({domain:t,applicableSchemaName:"item",isProvision:!0,modelName:"users",observe:n,condition:Boolean(n),query:{id:n}}),{user:c})}},803:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return s}));var r=n(62),a=n(146),i=n(10);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e){var t=e.domain,n=e.locationsIds,o=Object(r.d)((function(e){return Object(a.d)(e,"locations")||{}})),c=n.filter((function(e){return!o[e]})),u=Object(a.g)({domain:t,isProvision:!0,modelName:"locations",observe:n,condition:Boolean(c.length),query:{filter:{id:{comparator:"in",value:c}},navigation:{isDisabled:!0}}});return{locationsDict:o,isReady:Object(i.i)(u),isLoading:Object(i.h)(u),isError:Object(i.g)(u),counters:u.counters}}function s(e){var t=e.domain,n=u(Object(a.h)({domain:t,modelName:"locations",method:"POST"}),2),r=n[0];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n[1],{submitLocationRating:r})}},808:function(e,t,n){"use strict";var r=n(795);n.d(t,"a",(function(){return r.a}));n(797)},811:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return f}));var r=n(307),a=n(889),i=n(890),o=n(54),c=n(820),u=n.n(c),l="d MMMM yyyy",s="d MMMM",E="d";function d(e,t){var n=Object(o.a)(t,l,{locale:u.a});if(Object(r.a)(e,t))return n;var c="";return c=Object(a.a)(e,t)?Object(o.a)(e,E,{locale:u.a}):Object(i.a)(e,t)?Object(o.a)(e,s,{locale:u.a}):Object(o.a)(e,l,{locale:u.a}),"".concat(c,"—").concat(n)}function O(e){return d(e.departureDateTime,e.arrivalDateTime)}function f(e){var t=e.departureDateTime;return d(e.arrivalDateTime,t)}},824:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(0),a=n.n(r),i=n(783),o=n(907),c=n.n(o),u=n(811),l=n(88),s=n(825),E=Object(i.a)({icon:{color:"gray",fontSize:16,height:16},absoluteIcon:{color:"gray",fontSize:16,height:16,position:"absolute"},detail:{color:"gray",fontSize:12}});function d(e){var t=e.ride,n=e.ride,r=(n=void 0===n?{}:n).rideType,i=e.className,o=e.isLong,d=E();return t?a.a.createElement("div",{className:i},a.a.createElement(s.a,{ride:t,className:d.icon}),r===l.RIDE_TYPES.HITCH_HIKING&&a.a.createElement(c.a,{className:d.absoluteIcon}),o&&Object(u.a)(t)):null}},825:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(0),a=n.n(r),i=n(897),o=n.n(i),c=n(896),u=n.n(c),l=n(894),s=n.n(l),E=n(891),d=n.n(E),O=n(905),f=n.n(O),v=n(893),I=n.n(v),b=n(899),m=n.n(b),p=n(900),g=n.n(p),T=n(892),y=n.n(T),R=n(861),A=n.n(R),N=n(895),C=n.n(N),_=n(898),h=n.n(_),S=n(901),P=n.n(S),j=n(902),L=n.n(j),D=n(903),Y=n.n(D),w=n(904),V=n.n(w),B=n(906),U=n.n(B),G=n(88);function k(e){var t=e.ride.vehicleType,n=e.className,r=function(e){switch(e){case G.VEHICLE_TYPES.CAR:return d.a;case G.VEHICLE_TYPES.TRAIN:return y.a;case G.VEHICLE_TYPES.AIRCRAFT:return I.a;case G.VEHICLE_TYPES.BUS:case G.VEHICLE_TYPES.TROLLEY:case G.VEHICLE_TYPES.CITY_BUS:return s.a;case G.VEHICLE_TYPES.MOTORHOME:case G.VEHICLE_TYPES.JITNEY:return C.a;case G.VEHICLE_TYPES.LOCAL_TRAIN:return y.a;case G.VEHICLE_TYPES.FERRY:return u.a;case G.VEHICLE_TYPES.BIKE:return o.a;case G.VEHICLE_TYPES.BY_FEET:return h.a;case G.VEHICLE_TYPES.MOTORBIKE:return m.a;case G.VEHICLE_TYPES.TRUCK:return A.a;case G.VEHICLE_TYPES.ALL_TERRAIN_VEHICLE:return g.a;case G.VEHICLE_TYPES.TRAM:return P.a;case G.VEHICLE_TYPES.TAXI:return L.a;case G.VEHICLE_TYPES.SUBWAY:return Y.a;case G.VEHICLE_TYPES.PUBLIC_TRANSPORT:return V.a;case G.VEHICLE_TYPES.ROPEWAY:case G.VEHICLE_TYPES.FUNICULAR:return f.a;default:return U.a}}(t);return a.a.createElement(r,{className:n})}},909:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(2),o=n.n(i),c=n(1001),u=n.n(c),l=n(783),s=n(290),E=n(396),d=n.n(E),O=function(){var e=null,t=null;return{promise:new Promise((function(n,r){e=n,t=r})),resolver:e,rejector:t}};n.d(t,"a",(function(){return v}));var f=Object(l.a)({googleMapContainer:{margin:"12px 0",maxWidth:"100%",height:function(e){return e.height},maxHeight:"100%"}});function v(e){var t=e.locationsDict,n=e.locationsIds,i=e.height,o=f({height:i}),c=function(e){var t=Object(r.useMemo)(O,[]),n=t.promise,a=t.resolver,i=Object(r.useRef)(null),o=Object(r.useRef)(0);return Object(r.useEffect)((function(){d()(i,e)||(o.current+=1)})),Object(r.useEffect)((function(){var t=[];return n.then((function(n){var r=n.map,a=n.maps,i=new a.LatLngBounds;t=e.map((function(e){var t=e.lat,n=e.lon,o=new a.Marker({position:{lat:t,lng:n},map:r});return i.extend(o.position),o})),r.fitBounds(i),r.getZoom()>11&&r.setZoom(11)})),function(){return t.forEach((function(e){return e.setMap(null)}))}}),[o.current]),{handleGoogleApiLoaded:a}}(n.map((function(e){return t[e]}))).handleGoogleApiLoaded;return a.a.createElement("div",{className:o.googleMapContainer},a.a.createElement(u.a,{bootstrapURLKeys:{key:"AIzaSyCvP0e64ui7WpXKBdzOyEmkb4l5RuGy3Zs"},center:{lat:0,lng:0},zoom:11,onGoogleApiLoaded:c}))}v.propTypes={locationsDict:o.a.objectOf(o.a.shape(s.default)).isRequired,locationsIds:o.a.arrayOf(o.a.number).isRequired,height:o.a.string},v.defaultProps={height:"400px"}}}]);
//# sourceMappingURL=travel-TripStory-9b76ae23dc067474945e.js.map