{"version":3,"sources":["webpack:///./src/packages/travel/pages/LocationPage/useMarker.js","webpack:///./src/packages/travel/pages/LocationPage/LocationPage.jsx","webpack:///./src/modules/components/loaders/ProvisionLoader.jsx","webpack:///./src/core/connection/withProvision.jsx","webpack:///./src/modules/utilities/text/uniqTrimAndJoin.js","webpack:///./src/packages/travel/models/trips/utils/resolveTripCaption.js","webpack:///./src/packages/travel/models/trips/utils/index.js","webpack:///./src/modules/utilities/types/numbers.js","webpack:///./src/packages/travel/pages/TripStoryPage/TripStoryPage.jsx"],"names":["createControlledPromise","resolver","rejector","promise","Promise","resolve","reject","useMarker","_ref","lat","lon","_useMemo","useMemo","apiPromise","handleGoogleApiLoaded","useEffect","marker","then","api","map","maps","Marker","position","lng","setMap","renderOrderedAndCountedVisitsByYear","visitsList","ridesDict","yearly","visitsCountByYear","_ref2","arrivalRideId","arrivalDateTime","filter","Boolean","reduce","memo","date","year","getFullYear","Object","entries","sort","_ref4","_ref5","_slicedToArray","_ref8","_ref9","key","value","react_default","a","createElement","Fragment","react_router_dom","to","toUrl","String","concat","LocationPage","_ref10","classes","_ref10$location","location","locationName","_ref10$visits","visits","_ref10$visits$data","data","namedPaths","travel","noDataNode","length","orderedAndCountedVisitsByYear","className","container","googleMapContainer","lib_default","bootstrapURLKeys","__GOOGLE_MAP_API_KEY__","center","defaultZoom","onGoogleApiLoaded","propTypes","PropTypes","objectOf","string","isRequired","shape","locationPropTypes","arrayOf","visitPropTypes","ridePropTypes","compose","withStyles","fontSize","lineHeight","visitContainer","margin","fontWeight","width","maxWidth","height","maxHeight","withPaths","withProvision","state","_ref11","strLocationId","match","params","locationId","toNumber","_ref12$value","selectProvisionStatus","_ref12$value$location","requiredVisitIds","request","modelName","observe","query","id","location_id","comparator","navigation","isDisabled","rides","condition","visit_id","domain","selectDict","withLoader","Component","props","_props$provision","provision","_props$provision$isPe","isPending","hasFallback","PlainLoader","__webpack_exports__","_len2","arguments","provisionParams","Array","_key2","ExtendableComponent","_len","funcsArray","_key","arg","reduceRight","composed","func","provide","apply","uniqTrimAndJoin","array","maxLength","_ref$separator","separator","uniqArray","uniq","result","slice","join","resolveTripCaption","tripVisitsList","countriesDict","originCountryId","fallback","visitsByCountries","keys","groupBy","visitType","VISIT_TYPES","TRANSIT","countryId","Number","countryName","__webpack_require__","d","sortVisitsByTrips","utils_groupAndSortVisitsByTrips","orderInTrip","groupAndSortVisitsByTrips","mapValues","input","number","isNaN","NaN","parseFloat","r","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","prop_types__WEBPACK_IMPORTED_MODULE_1__","prop_types__WEBPACK_IMPORTED_MODULE_1___default","react_router__WEBPACK_IMPORTED_MODULE_2__","lodash_fp_compose__WEBPACK_IMPORTED_MODULE_3__","lodash_fp_compose__WEBPACK_IMPORTED_MODULE_3___default","_material_ui_core_styles__WEBPACK_IMPORTED_MODULE_4__","modules_utilities_memo__WEBPACK_IMPORTED_MODULE_5__","modules_utilities_types_numbers__WEBPACK_IMPORTED_MODULE_6__","core_connection__WEBPACK_IMPORTED_MODULE_7__","core_connection_withProvision__WEBPACK_IMPORTED_MODULE_8__","travel_models_rides_propTypes__WEBPACK_IMPORTED_MODULE_9__","travel_models_trips_propTypes__WEBPACK_IMPORTED_MODULE_10__","travel_models_trips_utils__WEBPACK_IMPORTED_MODULE_11__","travel_models_visits_propTypes__WEBPACK_IMPORTED_MODULE_12__","memoizedSortVisitsByTrips","memoizeByLastArgs","TripStoryPage","_ref$visits","_ref$visits$data","lastVisitIndex","storiesNodes","visitIndex","departureRideComment","visitId","departureRideId","visitComment","arrivalRideComment","rideComment","storyPart","contentNode","some","trips","tripPropTypes","ridesPropTypes","withRouter","strTripId","tripId","identity","trip_id"],"mappings":"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","file":"travel-TripStory-1bc229fbef8e8655c991.js","sourcesContent":["import { useMemo, useEffect } from 'react';\n\nconst createControlledPromise = () => {\n  // This fields will be initialized synchronously in promise constructor\n  let resolver = null;\n  let rejector = null;\n\n  const promise = new Promise((resolve, reject) => {\n    resolver = resolve;\n    rejector = reject;\n  });\n  return { promise, resolver, rejector };\n};\n\nexport default ({ lat, lon }) => {\n  const { promise: apiPromise, resolver: handleGoogleApiLoaded } = useMemo(\n    createControlledPromise,\n    [],\n  );\n\n  useEffect(\n    () => {\n      let marker;\n      apiPromise.then(api => {\n        const { map, maps } = api;\n        marker = new maps.Marker({ position: { lat, lng: lon }, map });\n      });\n      return () => {\n        if (marker) {\n          marker.setMap(null);\n        }\n      };\n    },\n    [lat, lon],\n  );\n  return { handleGoogleApiLoaded };\n};\n","/* globals __GOOGLE_MAP_API_KEY__ */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\nimport GoogleMapReact from 'google-map-react';\nimport compose from 'lodash/fp/compose';\nimport { withStyles } from '@material-ui/core/styles';\nimport { toNumber } from 'modules/utilities/types/numbers';\nimport { selectProvisionStatus, selectDict } from 'core/connection';\nimport withProvision from 'core/connection/withProvision';\nimport { withPaths } from 'core/context/AppContext';\nimport locationPropTypes from 'travel/models/locations/propTypes';\nimport visitPropTypes from 'travel/models/visits/propTypes';\nimport ridePropTypes from 'travel/models/rides/propTypes';\nimport useMarker from './useMarker';\n\nconst styles = {\n  container: { fontSize: '16px', lineHeight: '1.5' },\n  visitContainer: { margin: '20px 0' },\n  location: { fontWeight: 'bold', fontSize: '21px' },\n  googleMapContainer: {\n    margin: '12px 0',\n    width: '800px',\n    maxWidth: '100%',\n    height: '400px',\n    maxHeight: '100%',\n  },\n};\n\nconst renderOrderedAndCountedVisitsByYear = ({\n  visitsList,\n  ridesDict,\n  yearly,\n}) => {\n  const visitsCountByYear = visitsList\n    .map(({ arrivalRideId }) => {\n      const { arrivalDateTime } = ridesDict[arrivalRideId] || {};\n      return arrivalDateTime;\n    })\n    .filter(Boolean)\n    .reduce((memo, date) => {\n      const year = date.getFullYear();\n      if (!memo[year]) {\n        memo[year] = 0;\n      }\n      memo[year] += 1;\n      return memo;\n    }, {});\n\n  return Object.entries(visitsCountByYear)\n    .sort(([keyA], [keyB]) => keyA - keyB)\n    .map(([key, value]) => (\n      <>\n        <Link key={key} to={yearly.toUrl({ year: String(key) })}>\n          {value > 1 ? `${key} x${value}` : key}\n        </Link>{' '}\n      </>\n    ));\n};\n\nfunction LocationPage({\n  classes,\n  location: { locationName, lat, lon } = {},\n  visits: { data: visitsList = [] } = {},\n  ridesDict,\n  namedPaths: {\n    travel: { yearly },\n  },\n}) {\n  const noDataNode = <div>Заметки о поездке не найдены</div>;\n  if (!visitsList.length) {\n    return noDataNode;\n  }\n\n  const { handleGoogleApiLoaded } = useMarker({ lat, lon });\n\n  const orderedAndCountedVisitsByYear = renderOrderedAndCountedVisitsByYear({\n    visitsList,\n    ridesDict,\n    yearly,\n  });\n  return (\n    <div className={classes.container}>\n      <h1 className={classes.location}>{locationName}</h1>\n      <div>\n        <span>{`Посещено ${visitsList.length} раз`}</span>\n        &nbsp;\n        {orderedAndCountedVisitsByYear && (\n          <>\n            <span>в </span>\n            <span>{orderedAndCountedVisitsByYear}</span>\n          </>\n        )}\n      </div>\n      <div className={classes.googleMapContainer}>\n        <GoogleMapReact\n          bootstrapURLKeys={{ key: __GOOGLE_MAP_API_KEY__ }}\n          center={{ lat, lng: lon }}\n          defaultZoom={11}\n          onGoogleApiLoaded={handleGoogleApiLoaded}\n        />\n      </div>\n    </div>\n  );\n}\n\nLocationPage.propTypes = {\n  classes: PropTypes.objectOf(PropTypes.string).isRequired,\n  location: PropTypes.shape(locationPropTypes).isRequired,\n  visits: PropTypes.shape({\n    data: PropTypes.arrayOf(PropTypes.shape(visitPropTypes)),\n  }).isRequired,\n  ridesDict: PropTypes.objectOf(PropTypes.shape(ridePropTypes)).isRequired,\n};\n\nconst mapStateToProps = state => ({\n  ridesDict: selectDict(state, 'rides'),\n});\n\nconst mapStateToRequirements = (\n  state,\n  {\n    match: {\n      params: { strLocationId },\n    },\n  },\n) => {\n  const locationId = toNumber(strLocationId);\n  const {\n    value: { 'locationPage.visits': { data: requiredVisitIds } = {} } = {},\n  } = selectProvisionStatus(state, 'locationPage.visits') || {};\n  return {\n    request: {\n      location: {\n        modelName: 'locations',\n        observe: locationId,\n        query: { id: locationId },\n      },\n      visits: {\n        modelName: 'visits',\n        observe: locationId,\n        query: {\n          filter: { location_id: { comparator: '=', value: locationId } },\n          navigation: { isDisabled: true },\n        },\n      },\n      rides: {\n        modelName: 'rides',\n        condition: requiredVisitIds && requiredVisitIds.length,\n        observe: requiredVisitIds,\n        query: {\n          filter: { visit_id: { comparator: 'in', value: requiredVisitIds } },\n          navigation: { isDisabled: true },\n        },\n      },\n    },\n    domain: 'locationPage',\n  };\n};\n\nexport default compose(\n  withStyles(styles),\n  withPaths,\n  withProvision(mapStateToRequirements, mapStateToProps),\n)(LocationPage);\n","/* eslint-disable import/prefer-default-export */\nimport React from 'react';\nimport PlainLoader from 'modules/components/loaders/PlainLoader';\n\n// todo implement logic, which loader to show for each request, etc.\nexport const withLoader = Component => props => {\n  const { provision: { isPending = true, hasFallback } = {} } = props;\n  if (isPending && !hasFallback) {\n    return <PlainLoader />;\n  }\n  return <Component {...props} />;\n};\n","import { withLoader } from 'modules/components/loaders/ProvisionLoader';\nimport { provide } from 'core/connection';\n\nconst compose = (...funcsArray) => arg =>\n  funcsArray.reduceRight((composed, func) => func(composed), arg);\n\nexport default (...provisionParams) => ExtendableComponent =>\n  compose(\n    provide(...provisionParams),\n    withLoader,\n  )(ExtendableComponent);\n","import uniq from 'lodash/uniq';\n\nexport default (array, { maxLength, separator = ', ' }) => {\n  const uniqArray = uniq(array);\n  const result = uniqArray.slice(0, maxLength).join(separator);\n  if (uniqArray.length > maxLength) {\n    return `${result}...`;\n  }\n  return result;\n};\n","import groupBy from 'lodash/groupBy';\nimport uniqTrimAndJoin from 'modules/utilities/text/uniqTrimAndJoin';\nimport { VISIT_TYPES } from 'travel/models/visits/consts';\n\nexport default (tripVisitsList, countriesDict, originCountryId, fallback) => {\n  if (!tripVisitsList.length) {\n    return fallback;\n  }\n  const visitsByCountries = Object.keys(\n    groupBy(\n      tripVisitsList.filter(\n        ({ visitType }) => visitType !== VISIT_TYPES.TRANSIT,\n      ),\n      'countryId',\n    ),\n  );\n  if (visitsByCountries.length === 1) {\n    return (\n      uniqTrimAndJoin(tripVisitsList.map(({ locationName }) => locationName), {\n        maxLength: 4,\n      }) || fallback\n    );\n  }\n  return (\n    uniqTrimAndJoin(\n      visitsByCountries\n        .map(\n          countryId =>\n            Number(countryId) !== originCountryId &&\n            countriesDict[countryId] &&\n            countriesDict[countryId].countryName,\n        )\n        .filter(Boolean),\n      { maxLength: 4 },\n    ) || fallback\n  );\n};\n","import groupBy from 'lodash/groupBy';\nimport mapValues from 'lodash/mapValues';\n\nexport { default as resolveTripCaption } from './resolveTripCaption';\n\nexport const sortVisitsByTrips = visitsList =>\n  visitsList.sort(\n    ({ orderInTrip: orderInTripA }, { orderInTrip: orderInTripB }) =>\n      orderInTripA - orderInTripB,\n  );\n\nexport const groupAndSortVisitsByTrips = visitsList =>\n  mapValues(groupBy(visitsList, 'tripId'), sortVisitsByTrips);\n","export const toNumber = input => {\n  const number = Number(input);\n  return Number.isNaN(number) ? NaN : parseFloat(input);\n};\n\nexport const toInteger = input => {\n  const number = Number(input);\n  return Number.isNaN(number) ? NaN : parseInt(input, 10);\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router';\nimport compose from 'lodash/fp/compose';\nimport { withStyles } from '@material-ui/core/styles';\nimport { memoizeByLastArgs } from 'modules/utilities/memo';\nimport { toNumber } from 'modules/utilities/types/numbers';\nimport { selectDict } from 'core/connection';\nimport withProvision from 'core/connection/withProvision';\nimport ridesPropTypes from 'travel/models/rides/propTypes';\nimport tripPropTypes from 'travel/models/trips/propTypes';\nimport { sortVisitsByTrips } from 'travel/models/trips/utils';\nimport visitPropTypes from 'travel/models/visits/propTypes';\n\nconst memoizedSortVisitsByTrips = memoizeByLastArgs(sortVisitsByTrips);\n\nconst styles = {\n  container: { fontSize: '16px', lineHeight: '1.5' },\n  visitContainer: { margin: '20px 0' },\n  location: { fontWeight: 'bold', fontSize: '21px' },\n  storyPart: { margin: '12px 0' },\n};\n\nconst TripStoryPage = ({\n  classes,\n  visits: { data: visitsList = [] } = {},\n  ridesDict,\n}) => {\n  if (!ridesDict || !visitsList) {\n    return <div>None</div>;\n  }\n\n  const noDataNode = <div>Заметки о поездке не найдены</div>;\n  if (!visitsList.length) {\n    return noDataNode;\n  }\n\n  const lastVisitIndex = visitsList.length - 1;\n  const storiesNodes = memoizedSortVisitsByTrips(visitsList).map(\n    (\n      { visitId, arrivalRideId, departureRideId, visitComment, locationName },\n      visitIndex,\n    ) => {\n      const { rideComment: arrivalRideComment } =\n        ridesDict[arrivalRideId] || {};\n\n      let departureRideComment;\n      if (lastVisitIndex === visitIndex) {\n        const { rideComment } = ridesDict[departureRideId] || {};\n        departureRideComment = rideComment;\n      }\n\n      if (!arrivalRideComment && !departureRideComment && !visitComment) {\n        return null;\n      }\n      return (\n        <article key={`id${visitId}`} className={classes.visitContainer}>\n          <h1 className={classes.location}>{locationName}</h1>\n          {Boolean(arrivalRideComment) && (\n            <section className={classes.storyPart}>\n              {arrivalRideComment}\n            </section>\n          )}\n          {Boolean(visitComment) && (\n            <section className={classes.storyPart}>{visitComment}</section>\n          )}\n          {Boolean(departureRideComment) && (\n            <section className={classes.storyPart}>\n              {departureRideComment}\n            </section>\n          )}\n        </article>\n      );\n    },\n  );\n\n  const contentNode = storiesNodes.some(Boolean) ? storiesNodes : noDataNode;\n  return <div className={classes.container}>{contentNode}</div>;\n};\n\nTripStoryPage.propTypes = {\n  classes: PropTypes.objectOf(PropTypes.string).isRequired,\n  trips: PropTypes.shape({\n    data: PropTypes.arrayOf(PropTypes.shape(tripPropTypes)),\n  }).isRequired,\n  visits: PropTypes.shape({\n    data: PropTypes.arrayOf(PropTypes.shape(visitPropTypes)),\n  }).isRequired,\n  ridesDict: PropTypes.objectOf(PropTypes.shape(ridesPropTypes)).isRequired,\n};\n\nconst mapStateToRequirements = (\n  state,\n  {\n    match: {\n      params: { strTripId },\n    },\n  },\n) => {\n  const tripId = toNumber(strTripId);\n  return {\n    identity: {\n      strTripId,\n    },\n    request: {\n      rides: {\n        modelName: 'rides',\n        query: {\n          filter: { trip_id: { comparator: '=', value: tripId } },\n          navigation: { isDisabled: true },\n        },\n      },\n      visits: {\n        modelName: 'visits',\n        query: {\n          filter: { trip_id: { comparator: '=', value: tripId } },\n          navigation: { isDisabled: true },\n        },\n      },\n    },\n    domain: 'tripStoryPage',\n  };\n};\n\nconst mapStateToProps = state => ({\n  ridesDict: selectDict(state, 'rides'),\n});\n\nexport default compose(\n  withRouter,\n  withStyles(styles),\n  withProvision(mapStateToRequirements, mapStateToProps),\n)(TripStoryPage);\n"],"sourceRoot":""}