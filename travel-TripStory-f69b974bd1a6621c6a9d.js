(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1002:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(1),o=a.n(i),s=a(33),c=a(242),l=a.n(c),u=a(13),d=a(120),v=a(808),m=a(112),f=a(737),p=a(160),h=a(165),g=a(781),b=a(161),y=Object(d.a)(g.b),N=function(e){var t=e.classes,a=e.visits,r=(a=void 0===a?{}:a).data,i=void 0===r?[]:r,o=e.ridesDict;if(!o||!i)return n.a.createElement("div",null,"None");var s=n.a.createElement("div",null,"Заметки о поездке не найдены");if(!i.length)return s;var c=i.length-1,l=y(i).map(function(e,a){var r,i=e.visitId,s=e.arrivalRideId,l=e.departureRideId,u=e.visitComment,d=e.locationName,v=(o[s]||{}).rideComment;c===a&&(r=(o[l]||{}).rideComment);return v||r||u?n.a.createElement("article",{key:"id".concat(i),className:t.visitContainer},n.a.createElement("h1",{className:t.location},d),Boolean(v)&&n.a.createElement("section",{className:t.storyPart},v),Boolean(u)&&n.a.createElement("section",{className:t.storyPart},u),Boolean(r)&&n.a.createElement("section",{className:t.storyPart},r)):null}),u=l.some(Boolean)?l:s;return n.a.createElement("div",{className:t.container},u)};N.propTypes={classes:o.a.objectOf(o.a.string).isRequired,trips:o.a.shape({data:o.a.arrayOf(o.a.shape(h.default))}).isRequired,visits:o.a.shape({data:o.a.arrayOf(o.a.shape(b.default))}).isRequired,ridesDict:o.a.objectOf(o.a.shape(p.default)).isRequired};t.default=l()(s.g,Object(u.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},storyPart:{margin:"12px 0"}}),Object(f.a)(function(e,t){var a=t.match.params.strTripId,r=Object(v.a)(a);return{identity:{strTripId:a},request:{rides:{modelName:"rides",query:{filter:{trip_id:{comparator:"=",value:r}},navigation:{isDisabled:!0}}},visits:{modelName:"visits",query:{filter:{trip_id:{comparator:"=",value:r}},navigation:{isDisabled:!0}}}},domain:"tripStoryPage"}},function(e){return{ridesDict:Object(m.d)(e,"rides")}}))(N)},1011:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(1),o=a.n(i),s=a(808),c=a(937),l=a.n(c),u=a(242),d=a.n(u),v=a(13),m=a(112),f=a(737),p=a(163),h=a(161),g=a(160),b=function(){var e=null,t=null;return{promise:new Promise(function(a,r){e=a,t=r}),resolver:e,rejector:t}};function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var N=function(e){var t=e.classes,a=e.location,i=(a=void 0===a?{}:a).locationName,o=a.lat,s=a.lon,c=e.visits,u=(c=void 0===c?{}:c).data,d=void 0===u?[]:u,v=e.ridesDict,m=n.a.createElement("div",null,"Заметки о поездке не найдены");if(!d.length)return m;var f=function(e){var t=e.lat,a=e.lon,n=Object(r.useMemo)(b,[]),i=n.promise,o=n.resolver;return Object(r.useEffect)(function(){var e;return i.then(function(r){var n=r.map,i=r.maps;e=new i.Marker({position:{lat:t,lng:a},map:n})}),function(){e&&e.setMap(null)}},[t,a]),{handleGoogleApiLoaded:o}}({lat:o,lon:s}).handleGoogleApiLoaded,p=function(e){var t=e.visitsList,a=e.ridesDict,r=t.map(function(e){var t=e.arrivalRideId;return(a[t]||{}).arrivalDateTime}).filter(Boolean).reduce(function(e,t){var a=t.getFullYear();return e[a]||(e[a]=0),e[a]+=1,e},{});return Object.entries(r).sort(function(e,t){return y(e,1)[0]-y(t,1)[0]}).map(function(e){var t=y(e,2),a=t[0],r=t[1];return r>1?"".concat(a," x").concat(r):a}).join(", ")}({visitsList:d,ridesDict:v});return n.a.createElement("div",{className:t.container},n.a.createElement("h1",{className:t.location},i),n.a.createElement("div",null,n.a.createElement("span",null,"Посещено ".concat(d.length," раз"))," ",p&&n.a.createElement("span",null,"в ".concat(p))),n.a.createElement("div",{className:t.googleMapContainer},n.a.createElement(l.a,{bootstrapURLKeys:{key:"AIzaSyCvP0e64ui7WpXKBdzOyEmkb4l5RuGy3Zs"},center:{lat:o,lng:s},defaultZoom:11,onGoogleApiLoaded:f})))};N.propTypes={classes:o.a.objectOf(o.a.string).isRequired,location:o.a.shape(p.default).isRequired,visits:o.a.shape({data:o.a.arrayOf(o.a.shape(h.default))}).isRequired,ridesDict:o.a.objectOf(o.a.shape(g.default)).isRequired};var E=d()(Object(v.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},googleMapContainer:{margin:"12px 0",width:"800px",maxWidth:"100%",height:"400px",maxHeight:"100%"}}),Object(f.a)(function(e,t){var a=t.locationId,r=(Object(m.e)(e,"locationPage.visits")||{}).value,n=(r=void 0===r?{}:r)["locationPage.visits"],i=(n=void 0===n?{}:n).data;return{request:{location:{modelName:"locations",observe:a,query:{id:a}},visits:{modelName:"visits",observe:a,query:{filter:{location_id:{comparator:"=",value:a}},navigation:{isDisabled:!0}}},rides:{modelName:"rides",isNoop:!i||!i.length,observe:i,query:{filter:{visit_id:{comparator:"in",value:i}},navigation:{isDisabled:!0}}}},domain:"locationPage"}},function(e){return{ridesDict:Object(m.d)(e,"rides")}}))(N),O=function(e){var t=e.match.params.strLocationId;return n.a.createElement(E,{locationId:Object(s.a)(t)})};O.propTypes={match:o.a.shape({params:o.a.shape({strLocationId:o.a.string}).isRequired}).isRequired};t.default=O},737:function(e,t,a){"use strict";var r=a(0),n=a.n(r),i=a(244),o=function(e){return function(t){var a=t.provision,r=(a=void 0===a?{}:a).isPending,o=void 0===r||r,s=a.hasFallback;return o&&!s?n.a.createElement(i.a,null):n.a.createElement(e,t)}},s=a(112);t.a=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}}(s.a.apply(void 0,t),o)(e)}}},781:function(e,t,a){"use strict";a.d(t,"b",function(){return s}),a.d(t,"a",function(){return c});var r=a(746),n=a.n(r),i=a(782),o=a.n(i),s=function(e){return e.sort(function(e,t){return e.orderInTrip-t.orderInTrip})},c=function(e){return o()(n()(e,"tripId"),s)}},808:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var r=function(e){var t=Number(e);return Number.isNaN(t)?NaN:parseFloat(e)}}}]);
//# sourceMappingURL=travel-TripStory-f69b974bd1a6621c6a9d.js.map