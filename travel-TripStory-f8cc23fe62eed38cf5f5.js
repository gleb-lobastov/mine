(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1033:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(71),o=n(181),c=n(853),l=n(31),u=n(805),s=n(164),d="loc",E="c",v="yr",f="yr_c",m="c_yr",I="t",O="t_с",p="r_a",g="v_a",T="a",N={VISIT:{ARRIVAL_YEAR:"ARRIVAL_YEAR"},TRIP:{DEPARTURE_TIME:"TRIP_DEPARTURE_DATE",ID:"TRIP_ID"},COUNTRY:{VISITS:"COUNTRY_VISITS",RATING:"COUNTRY_RATING",NAME_ID:"COUNTRY_NAME_ID"},LOCATION:{VISITS:"LOCATION_VISITS",RATING:"LOCATION_RATING",NAME_ID:"LOCATION_NAME_ID"}},b=n(730),R=Object(b.a)((function(e){return{group:{backgroundColor:"white",top:0,"&:not(:first-of-type)":{marginTop:e.spacing(5)},"& ~ $subgroup":{marginTop:e.spacing(2)},"& + $subgroup ":{marginTop:0}},subgroup:{backgroundColor:"white",top:38},detail:{color:"gray",fontSize:12},formControl:{width:"100%"},ratingBlock:{display:"inline-flex",alignItems:"center"},ratingIcon:{color:"gray",fontSize:12},halfDown:{position:"relative",top:12}}})),A=n(734),y=n(735),C=n(1016),_=n(1043),h=n(1034),L=n(1019),P=n(165);function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=n(79),S=n.n(D),Y=n(374),w=n.n(Y),V=n(762),G=n.n(V),B=n(968);function M(e,t){return"t".concat(e,"_c").concat(t)}function k(e,t){return"y".concat(e,"_c").concat(t)}var H,U=null,F=null;function x(e,t,n,r){var a=e[t];a||(a=e[t]={});var i=a[n];i||(i=a[n]={});var o=i[r]||0;i[r]=o+1}function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=e.countries,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).visits,i=void 0===a?{}:a;return Object.keys(i).length}function z(e,t,n){var r=e.years,a=(r=void 0===r?{}:r)[n],i=(a=void 0===a?{}:a).locations;return(i=void 0===i?{}:i)[t]}function K(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=(J(H={},N.VISIT.ARRIVAL_YEAR,(function(){return function(e,t){var n=e.arrivalDateTime,r=t.arrivalDateTime;return n||r?n&&r?r.getFullYear()-n.getFullYear():n?-1:1:0}})),J(H,N.COUNTRY.NAME_ID,(function(e){var t=e.countriesDict;return function(e,n){var r=e.countryId,a=n.countryId,i=(t[r]||{}).countryName,o=(t[a]||{}).countryName;return i>o?1:o>i?-1:r-a}})),J(H,N.COUNTRY.RATING,(function(e){var t=e.countriesRating;return function(e,n){var r=e.countryId,a=n.countryId;return(t[r]||10)-(t[a]||10)}})),J(H,N.COUNTRY.VISITS,(function(e,t){return function(e,n){var r=e.countryId,a=n.countryId;return q(t,a)-q(t,r)}})),J(H,N.LOCATION.NAME_ID,(function(){return function(e,t){var n=e.locationId,r=e.locationName,a=t.locationId,i=t.locationName;return r>i?1:i>r?-1:n-a}})),J(H,N.LOCATION.RATING,(function(e){var t=e.locationsRating;return function(e,n){var r=e.locationId,a=n.locationId;return(t[r]||10)-(t[a]||10)}})),J(H,N.LOCATION.VISITS,(function(e,t){return function(e,n){var r=e.locationId,a=n.locationId;return W(t,a)-W(t,r)}})),J(H,N.TRIP.DEPARTURE_TIME,(function(e){var t=e.tripsDict;return function(e,n){var r=e.tripId,a=n.tripId,i=(t[r]||{}).departureDateTime,o=(t[a]||{}).departureDateTime;return i||o?i&&o?o.getFullYear()-i.getFullYear():i?-1:1:0}})),J(H,N.TRIP.ID,(function(){return function(e,t){return e.tripId-t.tripId}})),H);function X(e,t){switch(e){case g:return[null==t?void 0:t.VISITS];case p:return[null==t?void 0:t.RATING,null==t?void 0:t.VISITS];default:return[]}}function $(e,t,n){var r=n.map((function(n){var r=Z[n];return S()(r,"missing comparatorKey: %s",n),r?r(e,t):null})).filter(Boolean);return function(e,t){for(var n=0;n<r.length;n+=1){var a=r[n](e,t);if(a)return a}return 0}}Object(B.a)((function(e){return w()((function(t){var n=Object.values(e).filter((function(e){var n=e.countryId;return t===n})).map((function(e){return e.rating}));return n.length?G()(n)/n.length:0}))}));function Q(e){var t=e.country,n=(t=void 0===t?{}:t).countryName,r=e.isSubgroup,i=e.isDetail,c=e.className,l=e.children,u=R();return i?a.a.createElement("span",{className:c},n):a.a.createElement(o.a,{variant:r?"h5":"h4",className:r?u.subgroup:u.group},n," ",l)}function ee(e){var t,n,r,i,o,c,l=e.visit,u=l.tripId,s=l.visitId,d=l.countryId,v=e.changes,I=v.isTripChanged,p=v.isCountryChanged,g=e.provision.countriesDict,T=e.groupBy,N=e.year,b=e.counters,R=e.classes,A=T===O,y=T===f;if(!(p||A&&I))return null;var C=0;switch(T){case E:C=Object.keys((null==b?void 0:null===(t=b.countries)||void 0===t?void 0:null===(n=t[d])||void 0===n?void 0:n.locations)||{}).length;break;case m:case f:C=Object.keys((null==b?void 0:null===(r=b.yearsCountries)||void 0===r?void 0:null===(i=r[k(N,d)])||void 0===i?void 0:i.locations)||{}).length;break;case O:C=Object.keys((null==b?void 0:null===(o=b.tripsCountries)||void 0===o?void 0:null===(c=o[M(u,d)])||void 0===c?void 0:c.locations)||{}).length}return a.a.createElement(Q,{key:"c".concat(d,"_v").concat(s),country:g[d],isSubgroup:A||y},C>2&&a.a.createElement("span",{className:R.detail},"".concat(C," мест")))}var te=n(1020),ne=n(864),re=n.n(ne),ae=n(865),ie=n.n(ae),oe=n(866),ce=n.n(oe),le=n(763),ue=n(818),se=n.n(ue),de=n(817),Ee=n.n(de),ve=n(815),fe=n.n(ve),me=n(812),Ie=n.n(me),Oe=n(826),pe=n.n(Oe),ge=n(814),Te=n.n(ge),Ne=n(820),be=n.n(Ne),Re=n(821),Ae=n.n(Re),ye=n(813),Ce=n.n(ye),_e=n(776),he=n.n(_e),Le=n(816),Pe=n.n(Le),je=n(819),De=n.n(je),Se=n(822),Ye=n.n(Se),we=n(823),Ve=n.n(we),Ge=n(824),Be=n.n(Ge),Me=n(825),ke=n.n(Me),He=n(811),Ue=n.n(He),Fe=n(810),xe=n.n(Fe),We=n(75),qe=Object(b.a)({icon:{color:"gray",fontSize:16,height:16},absoluteIcon:{color:"gray",fontSize:16,height:16,position:"absolute"},detail:{color:"gray",fontSize:12}});function ze(e){var t=e.ride,n=(t=void 0===t?{}:t).rideId,r=t.vehicleType,i=t.rideType,o=e.className,c=qe(),l=n?function(e){switch(e){case We.VEHICLE_TYPES.CAR:return Ie.a;case We.VEHICLE_TYPES.TRAIN:return Ce.a;case We.VEHICLE_TYPES.AIRCRAFT:return Te.a;case We.VEHICLE_TYPES.BUS:case We.VEHICLE_TYPES.TROLLEY:case We.VEHICLE_TYPES.CITY_BUS:return fe.a;case We.VEHICLE_TYPES.MOTORHOME:case We.VEHICLE_TYPES.JITNEY:return Pe.a;case We.VEHICLE_TYPES.LOCAL_TRAIN:return Ce.a;case We.VEHICLE_TYPES.FERRY:return Ee.a;case We.VEHICLE_TYPES.BIKE:return se.a;case We.VEHICLE_TYPES.BY_FEET:return De.a;case We.VEHICLE_TYPES.MOTORBIKE:return be.a;case We.VEHICLE_TYPES.TRUCK:return he.a;case We.VEHICLE_TYPES.ALL_TERRAIN_VEHICLE:return Ae.a;case We.VEHICLE_TYPES.TRAM:return Ye.a;case We.VEHICLE_TYPES.TAXI:return Ve.a;case We.VEHICLE_TYPES.SUBWAY:return Be.a;case We.VEHICLE_TYPES.PUBLIC_TRANSPORT:return ke.a;case We.VEHICLE_TYPES.ROPEWAY:case We.VEHICLE_TYPES.FUNICULAR:default:return pe.a}}(r):xe.a;return a.a.createElement("div",{className:o},a.a.createElement(l,{className:c.icon}),i===We.RIDE_TYPES.HITCH_HIKING&&a.a.createElement(Ue.a,{className:c.absoluteIcon}))}var Ke=Object(b.a)({autoMargin:{marginLeft:"auto"}});function Je(e){var t=e.children,n=e.shouldJustifyContent,r=e.location,i=(r=void 0===r?{}:r).locationName,c=Ke(),l=a.a.Children.toArray(t);if(!n||l.length<=1)return a.a.createElement(o.a,null,i," ",t);var u=l.slice(-1),s=l.slice(0,-1);return a.a.createElement(te.a,{container:!0,justify:"space-between",alignItems:"center"},a.a.createElement(te.a,{item:!0},a.a.createElement(o.a,null,i," ",s)),a.a.createElement(te.a,{item:!0,classes:{item:c.autoMargin}},u))}var Ze=n(190),Xe=[d,v,I],$e=[d,E];function Qe(e){var t=e.visit,n=e.visit,r=n.visitId,i=n.locationId,c=n.countryId,l=n.departureRideId,u=e.classes,s=e.changes,O=s.isYearChanged,g=s.isCountryChanged,T=s.isTripChanged,N=s.isLocationChanged,b=e.year,R=e.provision,A=R.locationsDict,y=R.locationsRating,C=R.countriesDict,_=R.visitsDict,h=R.ridesDict,L=e.groupBy,P=e.sortBy,j=e.counters,D=L===I;if(!(D||T||O||g||N))return null;var S=Xe.includes(L)?a.a.createElement(Q,{country:C[c],className:u.detail,isDetail:!0}):null,Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=e.locationId;switch(r){case d:case E:return W(t,a);case v:case m:case f:return z(t,a,n)}}(t,j,b,L),w=P!==p&&Y>1?a.a.createElement("span",{className:u.detail},"".concat(Y," визитов")):null,V=P!==p&&$e.includes(L)?a.a.createElement("span",{className:u.detail},"в ".concat(function(e,t){var n=e.locations,r=(n=void 0===n?{}:n)[t],a=(r=void 0===r?{}:r).years,i=void 0===a?{}:a;return Object.keys(i)}(j,i).join(", "))):null,G=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).reduce((function(e,t,n){return n>0&&e.push(a.a.createElement("span",null," ")),e.push(t),e}),[])}(S,P===p?function(e){var t=e.locationRating,n=e.classes;return a.a.createElement("div",{className:n.ratingBlock},function(e){var t=e.locationRating,n=e.classes;switch(t){case Ze.LOCATION_RATING.PLACE_TO_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}));case Ze.LOCATION_RATING.FEW_PER_YEAR:case Ze.LOCATION_RATING.ONCE_PER_YEAR:return a.a.createElement(a.a.Fragment,null,a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}));case Ze.LOCATION_RATING.ONCE_PER_TWO_YEARS:case Ze.LOCATION_RATING.ONCE_PER_FIVE_YEARS:return a.a.createElement(a.a.Fragment,null,a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}));case Ze.LOCATION_RATING.ONCE_PER_DECADE:case Ze.LOCATION_RATING.TWICE_PER_LIVE:return a.a.createElement(a.a.Fragment,null,a.a.createElement(re.a,{className:n.ratingIcon}),a.a.createElement(re.a,{className:n.ratingIcon}));case Ze.LOCATION_RATING.ONCE_PER_LIVE:return a.a.createElement(re.a,{className:n.ratingIcon});case Ze.LOCATION_RATING.NEVER:return a.a.createElement(ie.a,{className:n.ratingIcon});default:return a.a.createElement(ce.a,{className:n.ratingIcon})}}({locationRating:t,classes:n}))}({classes:u,locationRating:null==y?void 0:y[i]}):null,w,V);return a.a.createElement(Je,{key:"l".concat(i,"_v").concat(r),location:A[i],country:C[c],shouldJustifyContent:D},G,D&&a.a.createElement(te.a,{container:!0},a.a.createElement(te.a,{item:!0},a.a.createElement(o.a,{className:u.detail},Object(le.b)(_[r]))),a.a.createElement(te.a,{item:!0},a.a.createElement(ze,{ride:h[l],className:u.halfDown}))))}var et=[d,v,I];function tt(e){var t=e.visit,n=t.tripId,r=t.arrivalRideId,i=e.classes,o=e.changes,c=o.isTripChanged,l=o.willTripChange,u=e.provision,s=u.tripsDict,d=u.locationsDict,E=u.countriesDict,v=u.ridesDict,f=e.groupBy,m=e.shouldRenderRide;if(!c&&!l)return null;var I=s[n];if(!I)return null;var O=I.originLocationId,p=d[O];if(!p)return null;var g=p.countryId,T=et.includes(f)?a.a.createElement(Q,{country:E[g],className:i.detail,isDetail:!0}):null;return a.a.createElement(Je,{key:"t".concat(n,"_ol").concat(O),location:d[O],country:E[g],shouldJustifyContent:m},T,m&&a.a.createElement(ze,{ride:v[r],className:i.halfDown}))}function nt(e){var t=e.trip,n=(t=void 0===t?{}:t).tripName,r=R();return a.a.createElement(o.a,{variant:"h4",className:r.group,paragraph:!0},n)}function rt(e){var t=e.visit,n=t.visitId,r=t.tripId,i=e.changes.isTripChanged,o=e.provision.tripsDict;return i?a.a.createElement(nt,{key:"t".concat(r,"_v").concat(n),trip:o[r]}):null}function at(e){var t=e.year,n=e.isSubgroup,r=R();return a.a.createElement(o.a,{variant:n?"h5":"h4",className:n?r.subgroup:r.group},t)}function it(e){var t=e.visit.visitId,n=e.changes,r=n.isYearChanged,i=n.isCountryChanged,o=e.groupBy,c=e.year,l=o===m;return r||l&&i?a.a.createElement(at,{key:"y".concat(c,"_v").concat(t),year:c,isSubgroup:l}):null}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){lt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ut=n(130),st=n.n(ut),dt=n(760),Et=n.n(dt);function vt(e,t,n){var r=e.reduce((function(e,r){var a=t[r];if(!a)return e;var i=n[r],o=a.countryId;return e[o]||(e[o]=[]),e[o].push(i),e}),{});return st()(r,(function(e){return function(e){if(!e.length)return 1/0;var t=e.length/e.map((function(e){return 1/e})).reduce((function(e,t){return e+t})),n=Et()(e),r=Math.log(e.length);return 1/(1/t+r/n)}(e)}))}function ft(e){var t=e.match.params.userAlias,n=R(),r=Object(s.b)(),b=r.queryFilter,D=(b=void 0===b?{}:b).group,S=void 0===D?d:D,Y=b.sort,w=void 0===Y?T:Y;!function(e,t){var n=t.groupBy,r=t.sortBy,i=R();Object(P.b)((function(t){var o=t.closeSidebar;return a.a.createElement(A.a,null,a.a.createElement(y.a,null,a.a.createElement(C.a,{className:i.formControl},a.a.createElement(_.a,{shrink:!0,id:"select-groupBy-filter-label"},"Сгруппировать"),a.a.createElement(h.a,{labelId:"select-groupBy-filter-label",autoWidth:!0,id:"select-groupBy-filter",value:n,onChange:function(t){o(),e(j({},"group",t.target.value))}},a.a.createElement(L.a,{value:d},"По городам"),a.a.createElement(L.a,{value:E},"По странам"),a.a.createElement(L.a,{value:v},"По годам"),a.a.createElement(L.a,{value:f},"По годам и странам"),a.a.createElement(L.a,{value:m},"По странам и годам"),a.a.createElement(L.a,{value:I},"По поездкам"),a.a.createElement(L.a,{value:O},"По поездкам и странам")))),n!==I&&a.a.createElement(y.a,null,a.a.createElement(C.a,{className:i.formControl},a.a.createElement(_.a,{shrink:!0,id:"select-sortBy-filter-label"},"Сортировать"),a.a.createElement(h.a,{labelId:"select-sortBy-filter-label",autoWidth:!0,id:"select-sortBy-filter",value:r,onChange:function(t){o(),e(j({},"sort",t.target.value))}},a.a.createElement(L.a,{value:T},"По алфавиту"),a.a.createElement(L.a,{value:g},"По числу посещений"),a.a.createElement(L.a,{value:p},"По рейтингу")))))}),[n,r])}(r.setQueryFilter,{groupBy:S,sortBy:w});var V=Object(u.a)({userAlias:t}),G=V.isPending,B=V.isError,H=V.updatesCounter,W=V.visitsIds,q=V.visitsDict,z=V.tripsDict,J=V.locationsIds,Z=V.locationsDict,Q=V.locationsRating,te=V.countriesDict,ne=Object(l.d)().travel.locations;if(B)return a.a.createElement("div",null,"...Error");if(G)return a.a.createElement("div",null,"...Loading");var re=W.map((function(e){return q[e]})).filter(Boolean),ae=function(e,t){if(t&&t===U)return F;var n={totalVisits:{},countries:{},years:{},trips:{},tripsCountries:{},yearsCountries:{},locations:{}};return e.forEach((function(e){var t,r=e.locationId,a=e.countryId,i=e.tripId,o=e.visitId,c=(t=e.arrivalDateTime)?t.getFullYear(t):null;x(n.countries,a,"visits",o),x(n.countries,a,"locations",r),x(n.countries,a,"years",c),x(n.countries,a,"trips",i),x(n.years,c,"locations",r),x(n.years,c,"countries",a),x(n.years,c,"trips",i),x(n.trips,i,"visits",o),x(n.trips,i,"locations",r),x(n.trips,i,"countries",a),x(n.locations,r,"visits",o),x(n.locations,r,"years",c),x(n.locations,r,"trips",i),x(n.tripsCountries,M(i,a),"locations",r),x(n.yearsCountries,k(c,a),"locations",r)}),{}),U=t,F=n,n}(re,H),ie=vt(J,Z,Q),oe=function(e,t,n){var r=e.groupBy,a=e.sortBy;switch(r){case I:return $(t,n,[N.TRIP.DEPARTURE_TIME,N.TRIP.ID,N.LOCATION.NAME]);case O:return $(t,n,[N.TRIP.DEPARTURE_TIME,N.TRIP.ID].concat(K(X(a,N.COUNTRY)),[N.COUNTRY.NAME_ID],K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]));case E:return $(t,n,[].concat(K(X(a,N.COUNTRY)),[N.COUNTRY.NAME_ID],K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]));case v:return $(t,n,[N.VISIT.ARRIVAL_YEAR].concat(K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]));case f:return $(t,n,[N.VISIT.ARRIVAL_YEAR].concat(K(X(a,N.COUNTRY)),[N.COUNTRY.NAME_ID],K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]));case m:return $(t,n,[].concat(K(X(a,N.COUNTRY)),[N.COUNTRY.NAME_ID,N.VISIT.ARRIVAL_YEAR],K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]));case d:default:return $(t,n,[].concat(K(X(a,N.LOCATION)),[N.LOCATION.NAME_ID]))}}({groupBy:S,sortBy:w},{locationsDict:Z,tripsDict:z,countriesDict:te,locationsRating:Q,countriesRating:ie},ae),ce=re.sort(oe),le=ce.reduce((function(e,t,r){var a=r>0?ce[r-1]:{},i=a.countryId,o=a.locationId,c=a.tripId,l=(r<ce.length-1?ce[r+1]:{}).tripId,u=t.countryId,s=t.locationId,p=t.tripId,g=mt(a),T=mt(t),N=function(e){return e===I||e===O}(S);return function(e){var t=e.groupBy,n=e.changes,r=n.isTripChanged,a=n.willTripChange;switch(t){case I:return[rt(e),r&&tt(ct({},e,{shouldRenderRide:!0})),Qe(e),a&&tt(ct({},e,{shouldRenderRide:!1}))];case O:return[rt(e),ee(e),Qe(e)];case E:return[ee(e),Qe(e)];case v:return[it(e),Qe(e)];case f:return[it(e),ee(e),Qe(e)];case m:return[ee(e),it(e),Qe(e)];case d:default:return[Qe(e)]}}({changes:{isTripChanged:N&&c!==p,willTripChange:N&&l!==p,isYearChanged:function(e){return e===v||e===m||e===f}(S)&&g!==T,isCountryChanged:function(e){return e===O||e===E||e===m||e===f}(S)&&i!==u,isLocationChanged:o!==s},classes:n,counters:ae,groupBy:S,sortBy:w,provision:V,visit:t,year:T}).filter(Boolean).forEach((function(t){e.push(t)})),e}),[]),ue=a.a.createElement(o.a,{variant:"h6",paragraph:!0},a.a.createElement("span",null,"Всего "),a.a.createElement(c.a,{to:ne.toUrl({userAlias:t}),component:i.b},"".concat(Object.keys((null==ae?void 0:ae.locations)||{}).length," городов ")),a.a.createElement("span",null,"из "),a.a.createElement("span",null,"".concat(Object.keys((null==ae?void 0:ae.countries)||{}).length," стран ")));return a.a.createElement("div",null,ue,le)}function mt(e){var t=e.arrivalDateTime;return t?t.getFullYear(t):null}n.d(t,"default",(function(){return ft}))},1037:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(2),c=n.n(o),l=n(979),u=n.n(l),s=n(730),d=n(101),E=n(1016),v=n(1043),f=n(1034),m=n(1019),I=n(190);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=(O(r={},I.LOCATION_RATING.PLACE_TO_LIVE,"Жил бы здесь"),O(r,I.LOCATION_RATING.FEW_PER_YEAR,"Несколько раз в год"),O(r,I.LOCATION_RATING.ONCE_PER_YEAR,"Раз в год"),O(r,I.LOCATION_RATING.ONCE_PER_TWO_YEARS,"Раз в пару лет"),O(r,I.LOCATION_RATING.ONCE_PER_FIVE_YEARS,"Раз в пять лет"),O(r,I.LOCATION_RATING.ONCE_PER_DECADE,"Раз в десятилетие"),O(r,I.LOCATION_RATING.TWICE_PER_LIVE,"Пару раз в жизни"),O(r,I.LOCATION_RATING.ONCE_PER_LIVE,"Раз в жизни"),O(r,I.LOCATION_RATING.NEVER,"Никогда"),r),g=Object(s.a)({formControl:{width:"100%"}});function T(e){var t=e.locationId,n=e.locationRating,r=e.isEditable,a=e.onSubmitLocationRating,o=g();return r?i.a.createElement(E.a,{className:o.formControl},i.a.createElement(v.a,{shrink:!0,id:"select-location-rating-label"},"Я бы ездил сюда"),i.a.createElement(f.a,{labelId:"select-location-rating-label",id:"select-location-rating",value:n,onChange:function(e){a(e,t,e.target.value)}},i.a.createElement(m.a,{value:I.LOCATION_RATING.PLACE_TO_LIVE},p[I.LOCATION_RATING.PLACE_TO_LIVE]),i.a.createElement(m.a,{value:I.LOCATION_RATING.FEW_PER_YEAR},p[I.LOCATION_RATING.FEW_PER_YEAR]),i.a.createElement(m.a,{value:I.LOCATION_RATING.ONCE_PER_YEAR},p[I.LOCATION_RATING.ONCE_PER_YEAR]),i.a.createElement(m.a,{value:I.LOCATION_RATING.ONCE_PER_TWO_YEARS},p[I.LOCATION_RATING.ONCE_PER_TWO_YEARS]),i.a.createElement(m.a,{value:I.LOCATION_RATING.ONCE_PER_FIVE_YEARS},p[I.LOCATION_RATING.ONCE_PER_FIVE_YEARS]),i.a.createElement(m.a,{value:I.LOCATION_RATING.ONCE_PER_DECADE},p[I.LOCATION_RATING.ONCE_PER_DECADE]),i.a.createElement(m.a,{value:I.LOCATION_RATING.TWICE_PER_LIVE},p[I.LOCATION_RATING.TWICE_PER_LIVE]),i.a.createElement(m.a,{value:I.LOCATION_RATING.ONCE_PER_LIVE},p[I.LOCATION_RATING.ONCE_PER_LIVE]),i.a.createElement(m.a,{value:I.LOCATION_RATING.NEVER},p[I.LOCATION_RATING.NEVER]))):i.a.createElement("div",null,p[n])}T.propTypes={locationRating:c.a.number,locationId:c.a.number.isRequired,isEditable:c.a.bool.isRequired,onSubmitLocationRating:c.a.func.isRequired},T.defaultProps={locationRating:null};var N=n(350),b=n.n(N),R=function(){var e=null,t=null;return{promise:new Promise((function(n,r){e=n,t=r})),resolver:e,rejector:t}},A=(n(751),n(743)),y=n(752);n.d(t,"default",(function(){return _}));var C=Object(s.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},googleMapContainer:{margin:"12px 0",width:"800px",maxWidth:"100%",height:"400px",maxHeight:"100%"}});function _(e){var t=e.match.params,n=t.userAlias,r=t.strLocationId,o=C(),c=Object(d.c)(),l=c.isAuthenticated,s=c.userAlias,E=function(e){var t=e.domain,n=e.userAlias,r=Object(A.a)({userAlias:n}),a=r.isError,i=r.isPending,o=r.locationsDict,c=r.locationsIds;return{isError:a,isPending:i,locationsDict:o,locationsIds:void 0===c?[]:c,locationsRating:r.locationsRating,submitLocationRating:Object(y.b)({domain:t}).submitLocationRating}}({domain:"travel.LocationsPage",userAlias:n}),v=E.isError,f=E.isPending,m=E.locationsDict,I=E.locationsIds,O=E.locationsRating,p=E.submitLocationRating,g=parseInt(r,10),N=g?[g]:I,_=Object(a.useCallback)((function(e,t,n){p({query:{rating:n,id:String(t)},condition:Boolean(t)})})),h=function(e){var t=Object(a.useMemo)(R,[]),n=t.promise,r=t.resolver,i=Object(a.useRef)(null),o=Object(a.useRef)(0);return Object(a.useEffect)((function(){b()(i,e)||(o.current+=1)})),Object(a.useEffect)((function(){var t=[];return n.then((function(n){var r=n.map,a=n.maps,i=new a.LatLngBounds;t=e.map((function(e){var t=e.lat,n=e.lon,o=new a.Marker({position:{lat:t,lng:n},map:r});return i.extend(o.position),o})),r.fitBounds(i),r.getZoom()>11&&r.setZoom(11)})),function(){return t.forEach((function(e){return e.setMap(null)}))}}),[o.current]),{handleGoogleApiLoaded:r}}(N.map((function(e){return m[e]}))).handleGoogleApiLoaded;if(v)return i.a.createElement("div",null,"...Error");if(f)return i.a.createElement("div",null,"...Loading");if(g&&!I.includes(g))return i.a.createElement("div",null,"Путешественик ".concat(n," еще не посетил данную локацию"));var L=l&&s===n;return i.a.createElement("div",{className:o.container},i.a.createElement("div",{className:o.googleMapContainer},i.a.createElement(u.a,{bootstrapURLKeys:{key:"AIzaSyCvP0e64ui7WpXKBdzOyEmkb4l5RuGy3Zs"},center:{lat:0,lng:0},zoom:11,onGoogleApiLoaded:h})),N.map((function(e){var t=m[e];if(!t)return null;var n=t.locationName;return i.a.createElement(i.a.Fragment,{key:e},i.a.createElement("h1",{className:o.location},n),i.a.createElement(T,{locationId:e,locationRating:O[e],isEditable:L,onSubmitLocationRating:_}))})))}_.propTypes={match:c.a.shape({params:c.a.shape({userAlias:c.a.string.isRequired,strLocationId:c.a.string}).isRequired}).isRequired}},1038:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(2),o=n.n(i),c=n(20),l=n(256),u=n.n(l),s=n(9),d=n(242),E=n(116),v=n(748),f=n(182),m=n(187),I=n(768),O=n(183),p=Object(d.a)(I.c),g=function(e){var t=e.classes,n=e.visits,r=(n=void 0===n?{}:n).data,i=void 0===r?[]:r,o=e.ridesDict;if(!o||!i)return a.a.createElement("div",null,"None");var c=a.a.createElement("div",null,"Заметки о поездке не найдены");if(!i.length)return c;var l=i.length-1,u=p(i).map((function(e,n){var r,i=e.visitId,c=e.arrivalRideId,u=e.departureRideId,s=e.visitComment,d=e.locationName,E=(o[c]||{}).rideComment;l===n&&(r=(o[u]||{}).rideComment);return E||r||s?a.a.createElement("article",{key:"id".concat(i),className:t.visitContainer},a.a.createElement("h1",{className:t.location},d),Boolean(E)&&a.a.createElement("section",{className:t.storyPart},E),Boolean(s)&&a.a.createElement("section",{className:t.storyPart},s),Boolean(r)&&a.a.createElement("section",{className:t.storyPart},r)):null})),s=u.some(Boolean)?u:c;return a.a.createElement("div",{className:t.container},s)};g.propTypes={classes:o.a.objectOf(o.a.string).isRequired,trips:o.a.shape({data:o.a.arrayOf(o.a.shape(m.default))}).isRequired,visits:o.a.shape({data:o.a.arrayOf(o.a.shape(O.default))}).isRequired,ridesDict:o.a.objectOf(o.a.shape(f.default)).isRequired};t.default=u()(c.g,Object(s.a)({container:{fontSize:"16px",lineHeight:"1.5"},visitContainer:{margin:"20px 0"},location:{fontWeight:"bold",fontSize:"21px"},storyPart:{margin:"12px 0"}}),Object(v.a)((function(e,t){var n,r,a=t.match.params.strTripId,i=(n=a,r=Number(n),Number.isNaN(r)?NaN:parseFloat(n));return{identity:{strTripId:a},request:{rides:{modelName:"rides",query:{filter:{trip_id:{comparator:"=",value:i}},navigation:{isDisabled:!0}}},visits:{modelName:"visits",query:{filter:{trip_id:{comparator:"=",value:i}},navigation:{isDisabled:!0}}}},domain:"tripStoryPage"}}),(function(e){return{ridesDict:Object(E.d)(e,"rides")}})))(g)},743:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var r=n(53),a=n(760),i=n.n(a),o=n(774),c=n.n(o),l=n(762),u=n.n(l),s=n(116),d=n(10),E=n(751),v=n(747),f=n(752);function m(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function I(e){var t=e.userAlias,n=function(e){var t=e.userAlias;return Object(s.i)({domain:"travel.trips-".concat(t),isProvision:!0,modelName:"trips",observe:t,query:{userAlias:t,navigation:{isDisabled:!0}}})}({userAlias:t}),a=Object(E.a)({domain:"travel.trips-".concat(t,".user"),userAlias:t}),i=a.user,o=(i=void 0===i?{}:i).locationsRating,c=void 0===o?{}:o,l=m(a,["user"]),I=(Object(d.o)(n)||{}).data,p=void 0===I?[]:I,g=Object(r.d)((function(e){return{tripsDict:Object(s.d)(e,"trips")||{},visitsDict:Object(s.d)(e,"visits")||{},ridesDict:Object(s.d)(e,"rides")||{},countriesDict:Object(s.d)(e,"countries")||{},locationsDict:Object(s.d)(e,"locations")||{}}})),T=g.tripsDict,N=g.visitsDict,b=g.ridesDict,R=g.countriesDict,A=g.locationsDict,y=Array.from(new Set(p.flatMap((function(e){var t;return(null===(t=T[e])||void 0===t?void 0:t.visits)||[]})))),C=Array.from(new Set(p.flatMap((function(e){var t;return(null===(t=T[e])||void 0===t?void 0:t.rides)||[]})))),_=Array.from(new Set(y.flatMap((function(e){var t;return(null===(t=N[e])||void 0===t?void 0:t.countryId)||[]})))),h=Array.from(new Set(y.flatMap((function(e){var t;return(null===(t=N[e])||void 0===t?void 0:t.locationId)||[]})))),L=Object(v.a)(),P=Object(f.a)({domain:"travel.locations-".concat(t),locationsIds:h}),j=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{updatesCounter:u()(t.map(d.p)),isReady:t.every(d.i),isPending:t.some(d.h),isValid:t.every(d.k),error:t.find(d.g),errors:t.map(d.f).filter(Boolean)}}(n,l,L,P);return{tripsProvision:n,countriesProvision:L,locationsProvision:P,isError:j.isError,isValid:j.isValid,isReady:j.isReady,isPending:j.isPending,tripsIds:p,tripsDict:T,visitsIds:y,visitsDict:N,ridesIds:C,ridesDict:b,ridesStats:O(C,b),locationsIds:h,locationsDict:A,locationsRating:c,countriesIds:_,countriesDict:R}}function O(e,t){return{earliestDeparture:new Date(c()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.departureDateTime.getTime()})))),latestArrival:new Date(i()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.arrivalDateTime.getTime()}))))}}},747:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(116),a=n(10);function i(){var e=Object(r.i)({domain:"travel.countries",isProvision:!0,modelName:"countries",query:{navigation:{isDisabled:!0}}}),t=(Object(a.o)(e)||{}).data;return{countriesIds:void 0===t?[]:t,isReady:Object(a.i)(e),isLoading:Object(a.h)(e),isError:Object(a.g)(e),counters:e.counters}}},748:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(258),o=function(e){return function(t){var n=t.provision,r=(n=void 0===n?{}:n).isPending,o=void 0===r||r,c=n.hasFallback;return o&&!c?a.a.createElement(i.a,null):a.a.createElement(e,t)}},c=n(116),l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}};t.a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return l(c.a.apply(void 0,t),o)(e)}}},751:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(53),a=n(116);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=e.domain,n=e.userAlias,c=Object(r.d)((function(e){return Object(a.f)(e,"users",n)}));return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(a.i)({domain:t,applicableSchemaName:"item",isProvision:!0,modelName:"users",observe:n,condition:Boolean(n),query:{id:n}}),{user:c})}},752:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s}));var r=n(53),a=n(116),i=n(10);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e){var t=e.domain,n=e.locationsIds,o=Object(r.d)((function(e){return Object(a.d)(e,"locations")||{}})),c=n.filter((function(e){return!o[e]})),l=Object(a.i)({domain:t,isProvision:!0,modelName:"locations",observe:n,condition:Boolean(c.length),query:{filter:{id:{comparator:"in",value:c}},navigation:{isDisabled:!0}}});return{locationsDict:o,isReady:Object(i.i)(l),isLoading:Object(i.h)(l),isError:Object(i.g)(l),counters:l.counters}}function s(e){var t=e.domain,n=l(Object(a.j)({domain:t,modelName:"locations",method:"POST"}),2),r=n[0];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n[1],{submitLocationRating:r})}},763:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return f}));var r=n(263),a=n(862),i=n(863),o=n(46),c=n(773),l=n.n(c),u="d MMMM yyyy",s="d MMMM",d="d";function E(e,t){var n=Object(o.a)(t,u,{locale:l.a});if(Object(r.a)(e,t))return n;var c="";return c=Object(a.a)(e,t)?Object(o.a)(e,d,{locale:l.a}):Object(i.a)(e,t)?Object(o.a)(e,s,{locale:l.a}):Object(o.a)(e,u,{locale:l.a}),"".concat(c,"—").concat(n)}function v(e){return E(e.departureDateTime,e.arrivalDateTime)}function f(e){var t=e.departureDateTime;return E(e.arrivalDateTime,t)}},768:function(e,t,n){"use strict";var r=n(777),a=n.n(r),i=n(764),o=n.n(i),c=function(e,t){var n=t.maxLength,r=t.separator,a=void 0===r?", ":r,i=o()(e),c=i.slice(0,n).join(a);return i.length>n?"".concat(c,"..."):c},l=n(188),u=function(e,t,n,r){if(!e.length)return r;var i=Object.keys(a()(e.filter((function(e){return e.visitType!==l.VISIT_TYPES.TRANSIT})),"countryId"));return 1===i.length?c(e.map((function(e){return e.locationName})),{maxLength:4})||r:c(i.map((function(e){return Number(e)!==n&&t[e]&&t[e].countryName})).filter(Boolean),{maxLength:4})||r};n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return u}));var s=function(e){return e.sort((function(e,t){return e.orderInTrip-t.orderInTrip}))}},805:function(e,t,n){"use strict";var r=n(743);n.d(t,"a",(function(){return r.a}));n(747)}}]);
//# sourceMappingURL=travel-TripStory-f8cc23fe62eed38cf5f5.js.map