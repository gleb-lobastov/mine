{"version":3,"sources":["webpack:///./src/packages/travel/pages/Dashboard/blocks/Description.jsx","webpack:///./src/modules/utilities/l10n/index.js","webpack:///./src/packages/travel/pages/Dashboard/blocks/ExternalLinks.jsx","webpack:///./src/packages/travel/pages/Dashboard/TravelDashboard.jsx","webpack:///./src/packages/travel/dataSource/useVisit.js","webpack:///./src/modules/components/Markdown/Markdown.jsx"],"names":["Description","countriesIds","locationsDict","locationsIds","visitsPaths","usePaths","travel","visits","countriesCounter","resolvePlural","length","one","many","locationsCounter","filter","locationsId","locationClass","LOCATION_CLASSES_ID","CITY","calcCitiesCount","Markdown","source","toUrl","counter","pluralOptions","amount","few","value","Math","abs","propTypes","PropTypes","arrayOf","number","isRequired","objectOf","shape","locationPropTypes","ExternalLinks","Button","component","target","rel","href","src","alt","useStyles","makeStyles","content","display","flexDirection","height","mapContainer","flexGrow","TravelDashboard","classes","useQueryFilter","queryFilter","setQueryFilter","useMarkersScaleSidebar","scaleBy","ratingLevel","useTripsStats","userAlias","isReady","locationsRating","visitsDict","className","LocationsMap","minHeight","MARKERS_SCALES","BY_RATING","undefined","useVisit","requiredVisitId","visitId","visit","useSelector","state","selectDict","useProvision","domain","isProvision","modelName","observe","condition","query","visit_id","comparator","navigation","isDisabled","useAddVisitPhotoRequest","useRequest","method","contentType","submitVisitPhoto","renderers","link","children","startsWith","to","string","oneOfType","node","forwardedProps"],"mappings":"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","file":"travel-Dashboard-8d11580945950cda21a4.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport Markdown from 'modules/components/Markdown';\nimport { usePaths } from 'modules/packages';\nimport { plural } from 'modules/utilities/l10n';\nimport { LOCATION_CLASSES_ID } from 'travel/models/locations/consts';\nimport locationPropTypes from 'travel/models/locations/propTypes';\n\nexport default function Description({\n  countriesIds,\n  locationsDict,\n  locationsIds,\n}) {\n  const {\n    travel: { visits: visitsPaths },\n  } = usePaths();\n\n  const countriesCounter = resolvePlural(countriesIds.length, {\n    one: 'стране',\n    many: 'странах',\n  });\n  const locationsCounter = resolvePlural(\n    calcCitiesCount(locationsIds, locationsDict),\n    {\n      one: 'городе',\n      many: 'городах',\n    },\n  );\n\n  return (\n    <Markdown\n      source={`\nСтатистика по моим путешествиям.\n\nЗдесь будет красивая инфографика, рассказы и фотки про 250 стран и\nтерриторий. Пока я побывал только в\n[${countriesCounter}](${visitsPaths.toUrl()}) и \n[${locationsCounter}](${visitsPaths.toUrl()}),\nа раз так, то и на инфографику пока забил.\n  `}\n    />\n  );\n}\n\nDescription.propTypes = {\n  countriesIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  locationsDict: PropTypes.objectOf(PropTypes.shape(locationPropTypes))\n    .isRequired,\n  locationsIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n};\n\nfunction calcCitiesCount(locationsIds, locationsDict = {}) {\n  return locationsIds.filter(\n    locationsId =>\n      locationsDict[locationsId]?.locationClass === LOCATION_CLASSES_ID.CITY,\n  ).length;\n}\n\nfunction resolvePlural(counter, pluralOptions) {\n  if (counter == null) {\n    return `... ${pluralOptions.many}`;\n  }\n  return `${counter} ${plural(counter, pluralOptions)}`;\n}\n","/* eslint-disable import/prefer-default-export */\nexport function plural(amount, { many, few = many, one }) {\n  let value = Math.abs(amount);\n  value %= 100;\n  if (value >= 5 && value <= 20) {\n    return many;\n  }\n  value %= 10;\n  if (value === 1) {\n    return one;\n  }\n  if (value >= 2 && value <= 4) {\n    return few;\n  }\n  return many;\n}\n","import React from 'react';\nimport Button from '@material-ui/core/Button';\n\nexport default function ExternalLinks() {\n  return (\n    <>\n      <div>\n        <Button\n          component=\"a\"\n          target=\"_blank\"\n          rel=\"nofollow noreferrer noopener\"\n          href=\"https://lobastov.livejournal.com/tag/%D0%9F%D1%83%D1%82%D0%B5%D1%88%D0%B5%D1%81%D1%82%D0%B2%D0%B8%D0%B5\"\n        >\n          Про путешествия в ЖЖ\n        </Button>\n      </div>\n      <a\n        href=\"https://my.flightradar24.com/lobastov\"\n        target=\"_blank\"\n        rel=\"nofollow noreferrer noopener\"\n      >\n        <img\n          src=\"https://banners-my.flightradar24.com/lobastov.png\"\n          alt=\"My Flightdiary.net profile\"\n        />\n      </a>\n    </>\n  );\n}\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useQueryFilter } from 'core/context/QueryFilterContext';\nimport { useTripsStats } from 'travel/dataSource';\nimport LocationsMap, {\n  useMarkersScaleSidebar,\n  MARKERS_SCALES,\n} from 'travel/components/common/LocationsMap';\nimport Description from './blocks/Description';\nimport ExternalLinks from './blocks/ExternalLinks';\n\nconst useStyles = makeStyles({\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: ' 100%',\n  },\n  mapContainer: {\n    flexGrow: 1,\n  },\n});\n\nexport default function TravelDashboard() {\n  const classes = useStyles();\n\n  const { queryFilter, setQueryFilter } = useQueryFilter();\n  const { scaleBy, ratingLevel } = useMarkersScaleSidebar(\n    setQueryFilter,\n    queryFilter,\n  );\n\n  const {\n    countriesIds,\n    isReady,\n    locationsDict,\n    locationsIds,\n    locationsRating,\n    visitsDict,\n  } = useTripsStats({\n    userAlias: 'my',\n  });\n\n  if (!isReady) {\n    return '...Loading';\n  }\n\n  return (\n    <div className={classes.content}>\n      <Description\n        countriesIds={countriesIds}\n        isReady={isReady}\n        locationsDict={locationsDict}\n        locationsIds={locationsIds}\n      />\n      <LocationsMap\n        className={classes.mapContainer}\n        locationsDict={locationsDict}\n        visitsDict={visitsDict}\n        locationsRating={locationsRating}\n        locationsIds={locationsIds}\n        minHeight={300}\n        scaleBy={scaleBy}\n        ratingLevel={\n          scaleBy === MARKERS_SCALES.BY_RATING ? ratingLevel : undefined\n        }\n      />\n      <ExternalLinks />\n    </div>\n  );\n}\n","import { useSelector } from 'react-redux';\nimport { useProvision, useRequest, selectDict } from 'core/connection';\n\nexport default function useVisit({ userAlias, visitId: requiredVisitId }) {\n  const { visitsDict } = useSelector(state => ({\n    visitsDict: selectDict(state, 'visits') || {},\n  }));\n  const visit = visitsDict[requiredVisitId];\n\n  return {\n    visit,\n    ...useProvision({\n      domain: `travel.visit${requiredVisitId}-${userAlias}`,\n      isProvision: true,\n      modelName: 'visits',\n      observe: requiredVisitId,\n      condition: !visit,\n      query: {\n        userAlias,\n        filter: { visit_id: { comparator: '=', value: requiredVisitId } },\n        navigation: { isDisabled: true },\n      },\n    }),\n  };\n}\n\nexport function useAddVisitPhotoRequest({ domain }) {\n  const [submitVisitPhoto, provision] = useRequest({\n    domain,\n    modelName: 'visits',\n    method: 'POST',\n    contentType: 'multipart/form-data',\n  });\n\n  return {\n    ...provision,\n    submitVisitPhoto,\n  };\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\nimport ReactMarkdown from 'react-markdown';\n\nconst renderers = {\n  link: ({ href, children }) =>\n    href.startsWith && href.startsWith('/') ? (\n      <Link to={href}>{children}</Link>\n    ) : (\n      <a href={href}>{children}</a>\n    ),\n};\nrenderers.link.propTypes = {\n  href: PropTypes.string.isRequired,\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.string]).isRequired,\n};\n\nexport default forwardedProps => (\n  <ReactMarkdown {...forwardedProps} renderers={renderers} />\n);\n"],"sourceRoot":""}