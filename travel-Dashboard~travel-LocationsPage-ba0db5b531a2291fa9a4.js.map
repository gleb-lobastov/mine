{"version":3,"sources":["webpack:///./src/packages/travel/dataSource/useTrips.js","webpack:///./src/packages/travel/dataSource/useCountries.js","webpack:///./src/modules/utilities/dateTime/isValidDate.js","webpack:///./src/packages/travel/dataSource/useUser.js","webpack:///./src/packages/travel/dataSource/useLocations.js","webpack:///./src/modules/utilities/dateTime/safeDateFormat.js","webpack:///./src/packages/travel/components/common/LocationsMap/utils/adaptMarkerData.js","webpack:///./src/packages/travel/components/common/LocationsMap/utils/resolveLocationFirstAndLastVisitDateTime.js","webpack:///./src/packages/travel/components/common/LocationsMap/consts.js","webpack:///./src/packages/travel/components/common/LocationsMap/utils/makeScaleUtils.js","webpack:///./src/modules/utilities/dateTime/formatDate.js","webpack:///./src/packages/travel/components/common/LocationsMap/utils/renderTitle.js","webpack:///./src/packages/travel/components/common/LocationsMap/utils/resolveMarkerUrl.js","webpack:///./src/packages/travel/components/common/LocationsMap/useMarkers.js","webpack:///./src/packages/travel/components/common/LocationsMap/blocks/MarkersScaleSelect/MarkersScaleSelect.jsx","webpack:///./src/packages/travel/components/common/LocationsMap/blocks/MarkersRatingLevelSelect/MarkersRatingLevelSelect.jsx","webpack:///./src/packages/travel/components/common/LocationsMap/useMarkersScaleSidebar.js","webpack:///./src/packages/travel/components/common/LocationsMap/LocationsMap.jsx","webpack:///./src/packages/travel/components/common/LocationsMap/utils/filterMarkerData.js"],"names":["useTripsStats","userAlias","tripsProvision","requiredTripsIds","tripsIds","tripsDict","useSelector","state","selectDict","shouldRequireAllTrips","missingTripsIds","filter","tripId","useProvision","domain","isProvision","modelName","observe","query","navigation","isDisabled","id","comparator","value","useTrips","useUser","user","locationsRating","userProvision","selectResult","data","visitsDict","ridesDict","countriesDict","locationsDict","visitsIds","useMemo","Array","from","Set","flatMap","tripsId","visits","ridesIds","rides","countriesIds","visitId","countryId","locationsIds","locationId","countriesProvision","useCountries","locationsProvision","useLocations","commonProvisionState","provisions","updatesCounter","sum","map","selectUpdatesCounter","isReady","every","selectIsReady","isPending","some","selectIsPending","isValid","selectIsValid","error","find","selectIsError","errors","selectError","Boolean","invalidate","forEach","mergeProvisionsState","isError","countriesRating","ratingsGroupedByCountries","reduce","memo","location","locationRating","push","mapValues","ratingsByCountry","ratings","length","Infinity","avg","rating","a","b","best","max","lengthRatio","Math","log","averageRating","calcCountriesRating","ridesStats","calcRidesStats","earliestDeparture","Date","min","rideId","departureDateTime","getTime","latestArrival","arrivalDateTime","isValidDate","date","Number","isNaN","selectItem","applicableSchemaName","condition","requiredLocationIds","missingLocationsIds","useLocationRatingRequest","useRequest","method","submitLocationRating","safeDateFormat","args","dateFormat","adaptMarkerData","lon","lat","locationName","accumulator","visit","firstVisitDateTime","lastVisitDateTime","resolveLocationFirstAndLastVisitDateTime","visitsCount","MARKERS_SCALES","BY_FIRST_VISIT","BY_LAST_VISIT","BY_VISITS_COUNT","BY_RATING","MARKERS_SCALE_DEFAULT","MARKERS_SCALE_BY_TIME_FILENAMES","MARKERS_SCALE_BY_SOURCES","MARKERS_RATING_LEVELS","ALL","WANT_COME_BACK","LOVE_THIS_PLACE","MARKERS_RATING_LEVEL_DEFAULT","stepByVisitsCount","stepByRating","LOCATION_RATING","PLACE_TO_LIVE","FEW_PER_YEAR","ONCE_PER_YEAR","ONCE_PER_TWO_YEARS","ONCE_PER_FIVE_YEARS","ONCE_PER_DECADE","TWICE_PER_LIVE","ONCE_PER_LIVE","NEVER","makeScaleByDateTimeUtils","field","resolveStep","step","minTime","diff","floor","resolveOptions","markersDataList","times","markerData","formatDate","locale","ru","renderRating","resolveMarkerUrl","scaleBy","markerSources","subPath","MarkersScaleSelect","classes","onClose","onChange","List","ListItem","FormControl","className","formControl","InputLabel","shrink","Select","labelId","autoWidth","event","nextScaleBy","target","updates","undefined","MenuItem","key","MarkersRatingLevelSelect","ratingLevel","propTypes","PropTypes","shape","string","isRequired","oneOf","Object","values","func","useStyles","makeStyles","width","setQueryFilter","queryFilter","scaleByQuery","ratingLevelQuery","includes","resolveActualScaleBy","resolveActualRatingLevel","useSidebar","closeSidebar","googleMapContainer","margin","maxWidth","flexGrow","minHeight","position","googleMapPosition","top","left","right","bottom","LocationsMap","handleGoogleApiLoaded","markersData","useState","googleMapsApi","setGoogleMapsApi","isFirsRenderRef","useRef","useEffect","maps","bounds","LatLngBounds","markers","iconUrl","title","zIndex","marker","Marker","lng","icon","url","scaledSize","Size","scale","extend","current","setOptions","maxZoom","minZoom","fitBounds","setMap","setVisible","api","useMarkers","actualMarkersData","adaptedMarkersData","filterMarkerData","makeScaleUtils","options","join","cls","bootstrapURLKeys","__GOOGLE_MAP_API_KEY__","center","zoom","onGoogleApiLoaded","objectOf","visitsPropTypes","locationPropTypes","arrayOf","number","defaultProps"],"mappings":"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","file":"travel-Dashboard~travel-LocationsPage-ba0db5b531a2291fa9a4.js","sourcesContent":["import { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\nimport max from 'lodash/max';\nimport min from 'lodash/min';\nimport sum from 'lodash/sum';\nimport mapValues from 'lodash/mapValues';\nimport { useProvision, selectDict } from 'core/connection';\nimport {\n  selectResult,\n  selectIsPending,\n  selectIsReady,\n  selectIsError,\n  selectError,\n  selectIsValid,\n  selectUpdatesCounter,\n} from 'core/connection/request/controllerRedux';\nimport useUser from './useUser';\nimport useCountries from './useCountries';\nimport useLocations from './useLocations';\n\nexport default function useTrips({ userAlias, tripsIds: requiredTripsIds }) {\n  const { tripsDict } = useSelector(state => ({\n    tripsDict: selectDict(state, 'trips') || {},\n  }));\n  const shouldRequireAllTrips = !requiredTripsIds;\n  const missingTripsIds =\n    !shouldRequireAllTrips &&\n    requiredTripsIds.filter(tripId => !tripsDict[tripId]);\n\n  return useProvision({\n    domain: `travel.trips-${userAlias}`,\n    isProvision: true,\n    modelName: 'trips',\n    observe: userAlias,\n    query: {\n      userAlias,\n      navigation: { isDisabled: true },\n      filter: shouldRequireAllTrips\n        ? {}\n        : { id: { comparator: 'in', value: missingTripsIds } },\n    },\n  });\n}\n\nexport function useTripsStats({ userAlias, tripsIds: requiredTripsIds }) {\n  const tripsProvision = useTrips({ userAlias, tripsIds: requiredTripsIds });\n  const { user: { locationsRating = {} } = {}, ...userProvision } = useUser({\n    domain: `travel.trips-${userAlias}.user`,\n    userAlias,\n  });\n\n  const { data: tripsIds = [] } = selectResult(tripsProvision) || {};\n\n  const {\n    tripsDict,\n    visitsDict,\n    ridesDict,\n    countriesDict,\n    locationsDict,\n  } = useSelector(state => ({\n    tripsDict: selectDict(state, 'trips') || {},\n    visitsDict: selectDict(state, 'visits') || {},\n    ridesDict: selectDict(state, 'rides') || {},\n    countriesDict: selectDict(state, 'countries') || {},\n    locationsDict: selectDict(state, 'locations') || {},\n  }));\n\n  const visitsIds = useMemo(\n    () =>\n      Array.from(\n        new Set(tripsIds.flatMap(tripsId => tripsDict[tripsId]?.visits || [])),\n      ),\n    [tripsIds, tripsDict],\n  );\n\n  const ridesIds = useMemo(\n    () =>\n      Array.from(\n        new Set(tripsIds.flatMap(tripsId => tripsDict[tripsId]?.rides || [])),\n      ),\n    [tripsIds, tripsDict],\n  );\n\n  const countriesIds = useMemo(\n    () =>\n      Array.from(\n        new Set(\n          visitsIds.flatMap(visitId => visitsDict[visitId]?.countryId || []),\n        ),\n      ),\n    [visitsIds, visitsDict],\n  );\n\n  const locationsIds = useMemo(\n    () =>\n      Array.from(\n        new Set(\n          visitsIds.flatMap(visitId => visitsDict[visitId]?.locationId || []),\n        ),\n      ),\n    [visitsIds, visitsDict],\n  );\n\n  const countriesProvision = useCountries();\n  const locationsProvision = useLocations({\n    domain: `travel.locations-${userAlias}`,\n    locationsIds,\n  });\n\n  const commonProvisionState = mergeProvisionsState(\n    tripsProvision,\n    userProvision,\n    countriesProvision,\n    locationsProvision,\n  );\n\n  const { isError, isValid, isReady, isPending } = commonProvisionState;\n\n  const countriesRating = calcCountriesRating(\n    locationsIds,\n    locationsDict,\n    locationsRating,\n  );\n\n  return {\n    tripsProvision,\n    countriesProvision,\n    locationsProvision,\n\n    isError,\n    isValid,\n    isReady,\n    isPending,\n\n    tripsIds,\n    tripsDict,\n    visitsIds,\n    visitsDict,\n    ridesIds,\n    ridesDict,\n    ridesStats: calcRidesStats(ridesIds, ridesDict),\n    locationsIds,\n    locationsDict,\n    locationsRating,\n    countriesIds,\n    countriesDict,\n    countriesRating,\n  };\n}\n\nfunction mergeProvisionsState(...provisions) {\n  return {\n    updatesCounter: sum(provisions.map(selectUpdatesCounter)),\n    isReady: provisions.every(selectIsReady),\n    isPending: provisions.some(selectIsPending),\n    isValid: provisions.every(selectIsValid),\n    error: provisions.find(selectIsError),\n    errors: provisions.map(selectError).filter(Boolean),\n    invalidate: () => provisions.forEach(({ invalidate }) => invalidate()),\n  };\n}\n\nfunction calcRidesStats(ridesIds, ridesDict) {\n  return {\n    earliestDeparture: new Date(\n      min(\n        ridesIds.map(rideId => ridesDict[rideId]?.departureDateTime.getTime()),\n      ),\n    ),\n    latestArrival: new Date(\n      max(ridesIds.map(rideId => ridesDict[rideId]?.arrivalDateTime.getTime())),\n    ),\n  };\n}\n\nfunction calcCountriesRating(locationsIds, locationsDict, locationsRating) {\n  const ratingsGroupedByCountries = locationsIds.reduce((memo, locationId) => {\n    const location = locationsDict[locationId];\n    if (!location) {\n      return memo;\n    }\n    const locationRating = locationsRating[locationId];\n    const { countryId } = location;\n    if (!memo[countryId]) {\n      memo[countryId] = [];\n    }\n    memo[countryId].push(locationRating);\n    return memo;\n  }, {});\n\n  return mapValues(ratingsGroupedByCountries, ratingsByCountry =>\n    averageRating(ratingsByCountry),\n  );\n}\n\nfunction averageRating(ratings) {\n  if (!ratings.length) {\n    return Infinity;\n  }\n  const avg =\n    ratings.length / ratings.map(rating => 1 / rating).reduce((a, b) => a + b);\n\n  const best = max(ratings);\n\n  const lengthRatio = Math.log(ratings.length);\n\n  return 1 / (1 / avg + lengthRatio / best);\n}\n","import { useProvision } from 'core/connection';\nimport {\n  selectResult,\n  selectIsReady,\n  selectIsPending,\n  selectIsError,\n} from 'core/connection/request/controllerRedux';\n\nexport default function useCountries() {\n  return useProvision({\n    domain: `travel.countries`,\n    isProvision: true,\n    modelName: 'countries',\n    query: { navigation: { isDisabled: true } },\n  });\n}\n","export default function isValidDate(date) {\n  return date instanceof Date && !Number.isNaN(date.getTime());\n}\n","import { useSelector } from 'react-redux';\nimport { useProvision, selectItem } from 'core/connection';\n\nexport default function useUser({ domain, userAlias }) {\n  const user = useSelector(state => selectItem(state, 'users', userAlias));\n  const provision = useProvision({\n    domain,\n    applicableSchemaName: 'item',\n    isProvision: true,\n    modelName: 'users',\n    observe: userAlias,\n    condition: Boolean(userAlias),\n    query: {\n      id: userAlias,\n    },\n  });\n  return { ...provision, user };\n}\n","import { useSelector } from 'react-redux';\nimport { useProvision, useRequest, selectDict } from 'core/connection';\n\nexport default function useLocations({\n  domain,\n  locationsIds: requiredLocationIds,\n}) {\n  const locationsDict = useSelector(\n    state => selectDict(state, 'locations') || {},\n  );\n\n  const missingLocationsIds = requiredLocationIds.filter(\n    locationId => !locationsDict[locationId],\n  );\n\n  return useProvision({\n    domain,\n    isProvision: true,\n    modelName: 'locations',\n    observe: requiredLocationIds,\n    condition: Boolean(missingLocationsIds.length),\n    query: {\n      filter: { id: { comparator: 'in', value: missingLocationsIds } },\n      navigation: { isDisabled: true },\n    },\n  });\n}\n\nexport function useLocationRatingRequest({ domain }) {\n  const [submitLocationRating, provision] = useRequest({\n    domain,\n    modelName: 'locations',\n    method: 'POST',\n  });\n\n  return {\n    ...provision,\n    submitLocationRating,\n  };\n}\n","import dateFormat from 'date-fns/format';\nimport isValidDate from './isValidDate';\n\nexport default function safeDateFormat(date, ...args) {\n  if (!isValidDate(date)) {\n    return '?';\n  }\n  return dateFormat(date, ...args);\n}\n","import resolveLocationFirstAndLastVisitDateTime from './resolveLocationFirstAndLastVisitDateTime';\n\nexport default function adaptMarkerData({\n  locationsIds,\n  locationsDict,\n  visitsDict,\n  locationsRating,\n}) {\n  return locationsIds.map(locationId => {\n    const location = locationsDict[locationId];\n    if (!location) {\n      return null;\n    }\n    const { lon, lat, locationName, visitsIds } = location;\n    const {\n      firstVisitDateTime,\n      lastVisitDateTime,\n    } = resolveLocationFirstAndLastVisitDateTime(visitsIds, visitsDict);\n\n    return {\n      locationName,\n      lat,\n      lon,\n      firstVisitDateTime,\n      lastVisitDateTime,\n      locationRating: locationsRating[locationId],\n      visitsCount: location.visitsIds.length,\n    };\n  });\n}\n","import min from 'lodash/min';\nimport max from 'lodash/max';\n\nexport default function resolveLocationFirstAndLastVisitDateTime(\n  visitsIds,\n  visitsDict,\n) {\n  return visitsIds.reduce(\n    (accumulator, visitId) => {\n      const visit = visitsDict[visitId];\n      if (visit) {\n        const { arrivalDateTime, departureDateTime } = visit;\n        accumulator.firstVisitDateTime = min([\n          accumulator.firstVisitDateTime,\n          arrivalDateTime,\n        ]);\n        accumulator.lastVisitDateTime = max([\n          accumulator.lastVisitDateTime,\n          departureDateTime,\n        ]);\n      }\n      return accumulator;\n    },\n    { firstVisitDateTime: null, lastVisitDateTime: null },\n  );\n}\n","export const KEY_MARKERS_SCALE_BY = 'scale';\n\nexport const MARKERS_SCALES = {\n  BY_FIRST_VISIT: 'fv',\n  BY_LAST_VISIT: 'lv',\n  BY_VISITS_COUNT: 'vc',\n  BY_RATING: 'r',\n};\n\nexport const MARKERS_SCALE_DEFAULT = MARKERS_SCALES.BY_LAST_VISIT;\n\nexport const MARKERS_SCALE_IMAGES_BASE_PATH =\n  'https://res.cloudinary.com/dc2eke0gj/image/upload/markers/';\n\nexport const MARKERS_SCALE_BY_TIME_FILENAMES = [\n  'step_by_time_1_zjtrlw.png',\n  'step_by_time_2_tvotvg.png',\n  'step_by_time_3_ylj1vi.png',\n  'step_by_time_4_uovfrs.png',\n  'step_by_time_5_s4jq0u.png',\n  'step_by_time_6_lmihnf.png',\n];\n\nexport const MARKERS_SCALE_BY_RATING_FILENAMES = [\n  'step_by_rating_1_id2qgb.png',\n  'step_by_rating_2_iiqvik.png',\n  'step_by_rating_3_x2gzsd.png',\n  'step_by_rating_4_cbqdcn.png',\n  'step_by_rating_5_viyhls.png',\n  'step_by_rating_6_zzfgki.png',\n  'step_by_rating_7_pjjhhq.png',\n  'step_by_rating_8_vgetsd.png',\n  'step_by_rating_9_t6tenz.png',\n  'step_by_rating_10_yjywr0.png',\n];\n\nexport const MARKERS_SCALE_BY_VISITS_FILENAMES = [\n  'step_by_visits_1_zv3tba.png',\n  'step_by_visits_2_qthjqa.png',\n  'step_by_visits_3_xcjyla.png',\n  'step_by_visits_4_kwdwka.png',\n  'step_by_visits_5_xnnipa.png',\n];\n\nexport const MARKERS_SCALE_BY_SOURCES = {\n  [MARKERS_SCALES.BY_FIRST_VISIT]: MARKERS_SCALE_BY_TIME_FILENAMES,\n  [MARKERS_SCALES.BY_LAST_VISIT]: MARKERS_SCALE_BY_TIME_FILENAMES,\n  [MARKERS_SCALES.BY_VISITS_COUNT]: MARKERS_SCALE_BY_VISITS_FILENAMES,\n  [MARKERS_SCALES.BY_RATING]: MARKERS_SCALE_BY_RATING_FILENAMES,\n};\n\nexport const MARKERS_RATING_LEVELS = {\n  ALL: 'all',\n  WANT_COME_BACK: 'good',\n  LOVE_THIS_PLACE: 'best',\n};\n\nexport const KEY_MARKERS_RATING_LEVEL = 'rating';\n\nexport const MARKERS_RATING_LEVEL_DEFAULT = MARKERS_RATING_LEVELS.ALL;\n","import min from 'lodash/min';\nimport max from 'lodash/max';\nimport { LOCATION_RATING } from 'travel/models/users/consts';\nimport { MARKERS_SCALES } from '../consts';\n\nexport default function makeScaleUtils(scaleBy) {\n  switch (scaleBy) {\n    case MARKERS_SCALES.BY_VISITS_COUNT:\n      return {\n        resolveStep: stepByVisitsCount,\n      };\n    case MARKERS_SCALES.BY_RATING:\n      return {\n        resolveStep: stepByRating,\n      };\n    case MARKERS_SCALES.BY_LAST_VISIT:\n      return makeScaleByDateTimeUtils('lastVisitDateTime');\n    case MARKERS_SCALES.BY_FIRST_VISIT:\n    default:\n      return makeScaleByDateTimeUtils('firstVisitDateTime');\n  }\n}\n\nfunction stepByVisitsCount({ visitsCount }) {\n  switch (true) {\n    case visitsCount > 10:\n      return 5;\n    case visitsCount > 5:\n      return 4;\n    case visitsCount > 2:\n      return 3;\n    case visitsCount > 1:\n      return 2;\n    default:\n      return 1;\n  }\n}\n\nfunction stepByRating({ locationRating }) {\n  switch (locationRating) {\n    case LOCATION_RATING.PLACE_TO_LIVE:\n      return 1;\n    case LOCATION_RATING.FEW_PER_YEAR:\n    case LOCATION_RATING.ONCE_PER_YEAR:\n      return 3;\n    case LOCATION_RATING.ONCE_PER_TWO_YEARS:\n    case LOCATION_RATING.ONCE_PER_FIVE_YEARS:\n      return 4;\n    case LOCATION_RATING.ONCE_PER_DECADE:\n    case LOCATION_RATING.TWICE_PER_LIVE:\n      return 7;\n    case LOCATION_RATING.ONCE_PER_LIVE:\n      return 9;\n    case LOCATION_RATING.NEVER:\n      return 10;\n    default:\n      return 6;\n  }\n}\n\nconst stepsByDateTimeCount = 6;\nfunction makeScaleByDateTimeUtils(field) {\n  return {\n    resolveStep: function stepByDateTime(\n      { [field]: dateTime },\n      { minTime, diff },\n    ) {\n      const step = ((dateTime - minTime) / diff) * stepsByDateTimeCount;\n      return Math.min(Math.max(Math.floor(step), 0), stepsByDateTimeCount);\n    },\n    resolveOptions: function resolveOptionsForStepByDateTime(markersDataList) {\n      const times = markersDataList\n        .map(markerData => markerData[field] && markerData[field].getTime())\n        .filter(Boolean);\n\n      const minTime = min(times);\n      const maxTime = max(times) + 1;\n      const diff = maxTime - minTime;\n      return { minTime, diff };\n    },\n  };\n}\n","import ru from 'date-fns/locale/ru';\nimport dateFormat from './safeDateFormat';\n\nexport default function formatDate(date) {\n  return dateFormat(date, 'eeeeee, d MMMM yyyy', { locale: ru });\n}\n","import formatDate from 'modules/utilities/dateTime/formatDate';\nimport { LOCATION_RATING } from 'travel/models/users/consts';\n\nexport default function renderTitle({\n  locationName,\n  locationRating,\n  visitsCount,\n  firstVisitDateTime,\n  lastVisitDateTime,\n}) {\n  return [\n    locationName,\n    `Посещено ${visitsCount} раз`,\n    `Впервые ${formatDate(firstVisitDateTime)}`,\n    visitsCount > 1 && `Прошлое посешение ${formatDate(lastVisitDateTime)}`,\n    `Рейтинг: ${renderRating(locationRating)}`,\n  ]\n    .filter(Boolean)\n    .join('\\n');\n}\n\nfunction renderRating(locationRating) {\n  switch (locationRating) {\n    case LOCATION_RATING.PLACE_TO_LIVE:\n      return 'Жил бы здесь';\n    case LOCATION_RATING.FEW_PER_YEAR:\n    case LOCATION_RATING.ONCE_PER_YEAR:\n      return 'Готов ездить сюда постоянно';\n    case LOCATION_RATING.ONCE_PER_TWO_YEARS:\n    case LOCATION_RATING.ONCE_PER_FIVE_YEARS:\n      return 'Приезжал бы иногда';\n    case LOCATION_RATING.ONCE_PER_DECADE:\n    case LOCATION_RATING.TWICE_PER_LIVE:\n      return 'Заглянул бы еще разок';\n    case LOCATION_RATING.ONCE_PER_LIVE:\n      return 'Одного посещения достаточно';\n    case LOCATION_RATING.NEVER:\n      return 'Тут нечего делать';\n    default:\n      return '?';\n  }\n}\n","import {\n  MARKERS_SCALE_BY_SOURCES,\n  MARKERS_SCALE_IMAGES_BASE_PATH,\n} from '../consts';\n\nexport default function resolveMarkerUrl(step, scaleBy) {\n  const markerSources = MARKERS_SCALE_BY_SOURCES[scaleBy];\n  const subPath = markerSources[step - 1] || markerSources[0];\n  return `${MARKERS_SCALE_IMAGES_BASE_PATH}${subPath}`;\n}\n","import { useState, useEffect, useRef } from 'react';\n\nexport default markersData => {\n  const [googleMapsApi, setGoogleMapsApi] = useState(null);\n\n  const isFirsRenderRef = useRef(true);\n\n  useEffect(\n    () => {\n      if (!googleMapsApi) {\n        return undefined;\n      }\n      const { map, maps } = googleMapsApi;\n      const bounds = new maps.LatLngBounds();\n      const markers = markersData.map(\n        ({ lat, lon, iconUrl, title, zIndex }) => {\n          const marker = new maps.Marker({\n            map,\n            position: { lat, lng: lon },\n            icon: {\n              url: iconUrl,\n              scaledSize: new maps.Size(24, 24),\n            },\n            scale: 0.5,\n            title,\n            zIndex,\n          });\n          bounds.extend(marker.position);\n          return marker;\n        },\n      );\n      if (isFirsRenderRef.current) {\n        map.setOptions({ maxZoom: 11, minZoom: 2 });\n        map.fitBounds(bounds);\n        map.setOptions({ maxZoom: null, minZoom: null });\n        isFirsRenderRef.current = false;\n      }\n      return () => {\n        markers.forEach(marker => {\n          marker.setMap(null);\n          marker.setVisible(false);\n        });\n        markers.length = 0;\n      };\n    },\n    [googleMapsApi, markersData],\n  );\n  return { handleGoogleApiLoaded: api => setGoogleMapsApi(api) };\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport {\n  MARKERS_SCALES,\n  KEY_MARKERS_SCALE_BY,\n  KEY_MARKERS_RATING_LEVEL,\n} from '../../consts';\n\nexport default function MarkersScaleSelect({\n  classes,\n  scaleBy,\n  onClose,\n  onChange,\n}) {\n  return (\n    <List>\n      <ListItem>\n        <FormControl className={classes.formControl}>\n          <InputLabel shrink={true} id=\"select-scaleBy-filter-label\">\n            Раскрасить маркеры\n          </InputLabel>\n          <Select\n            labelId=\"select-scaleBy-filter-label\"\n            autoWidth={true}\n            id=\"select-scaleBy-filter\"\n            value={scaleBy}\n            onChange={event => {\n              onClose();\n              const nextScaleBy = event.target.value;\n              const updates = { [KEY_MARKERS_SCALE_BY]: nextScaleBy };\n              if (nextScaleBy !== MARKERS_SCALES.BY_RATING) {\n                updates[KEY_MARKERS_RATING_LEVEL] = undefined;\n              }\n              onChange(updates);\n            }}\n          >\n            <MenuItem\n              key={MARKERS_SCALES.BY_FIRST_VISIT}\n              value={MARKERS_SCALES.BY_FIRST_VISIT}\n            >\n              По первому посещению\n            </MenuItem>\n            <MenuItem\n              key={MARKERS_SCALES.BY_LAST_VISIT}\n              value={MARKERS_SCALES.BY_LAST_VISIT}\n            >\n              По последнему посещению\n            </MenuItem>\n            <MenuItem\n              key={MARKERS_SCALES.BY_VISITS_COUNT}\n              value={MARKERS_SCALES.BY_VISITS_COUNT}\n            >\n              По числу посещений\n            </MenuItem>\n            <MenuItem\n              key={MARKERS_SCALES.BY_RATING}\n              value={MARKERS_SCALES.BY_RATING}\n            >\n              По рейтингу\n            </MenuItem>\n          </Select>\n        </FormControl>\n      </ListItem>\n    </List>\n  );\n}\n\nMarkersScaleSelect.propTypes = {\n  classes: PropTypes.shape({ formControl: PropTypes.string.isRequired })\n    .isRequired,\n  scaleBy: PropTypes.oneOf(Object.values(MARKERS_SCALES)).isRequired,\n  onClose: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { MARKERS_RATING_LEVELS, KEY_MARKERS_RATING_LEVEL } from '../../consts';\n\nexport default function MarkersRatingLevelSelect({\n  classes,\n  ratingLevel,\n  onClose,\n  onChange,\n}) {\n  return (\n    <List>\n      <ListItem>\n        <FormControl className={classes.formControl}>\n          <InputLabel shrink={true} id=\"select-ratingLevel-filter-label\">\n            Фильтр по рейтингу\n          </InputLabel>\n          <Select\n            labelId=\"select-ratingLevel-filter-label\"\n            autoWidth={true}\n            id=\"select-ratingLevel-filter\"\n            value={ratingLevel}\n            onChange={event => {\n              onClose();\n              onChange({\n                [KEY_MARKERS_RATING_LEVEL]: event.target.value,\n              });\n            }}\n          >\n            <MenuItem\n              key={MARKERS_RATING_LEVELS.ALL}\n              value={MARKERS_RATING_LEVELS.ALL}\n            >\n              Все\n            </MenuItem>\n            <MenuItem\n              key={MARKERS_RATING_LEVELS.WANT_COME_BACK}\n              value={MARKERS_RATING_LEVELS.WANT_COME_BACK}\n            >\n              Куда бы вернулся\n            </MenuItem>\n            <MenuItem\n              key={MARKERS_RATING_LEVELS.LOVE_THIS_PLACE}\n              value={MARKERS_RATING_LEVELS.LOVE_THIS_PLACE}\n            >\n              Лучшие места\n            </MenuItem>\n          </Select>\n        </FormControl>\n      </ListItem>\n    </List>\n  );\n}\n\nMarkersRatingLevelSelect.propTypes = {\n  classes: PropTypes.shape({ formControl: PropTypes.string.isRequired })\n    .isRequired,\n  ratingLevel: PropTypes.oneOf(Object.values(MARKERS_RATING_LEVELS)).isRequired,\n  onClose: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n};\n","import React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useSidebar } from 'core/context/SidebarContext';\nimport MarkersScaleSelect from './blocks/MarkersScaleSelect';\nimport MarkersRatingLevelSelect from './blocks/MarkersRatingLevelSelect';\nimport {\n  MARKERS_SCALES,\n  KEY_MARKERS_SCALE_BY,\n  MARKERS_SCALE_DEFAULT,\n  MARKERS_RATING_LEVELS,\n  KEY_MARKERS_RATING_LEVEL,\n  MARKERS_RATING_LEVEL_DEFAULT,\n} from './consts';\n\nconst useStyles = makeStyles({\n  formControl: {\n    width: '100%',\n  },\n});\n\nexport default function(setQueryFilter, queryFilter) {\n  const classes = useStyles();\n  const {\n    [KEY_MARKERS_SCALE_BY]: scaleByQuery,\n    [KEY_MARKERS_RATING_LEVEL]: ratingLevelQuery,\n  } = queryFilter || {};\n  const scaleBy = resolveActualScaleBy(scaleByQuery);\n  const ratingLevel = resolveActualRatingLevel(ratingLevelQuery);\n  useSidebar(\n    ({ closeSidebar }) => (\n      <>\n        <MarkersScaleSelect\n          classes={classes}\n          onClose={closeSidebar}\n          scaleBy={scaleBy}\n          onChange={setQueryFilter}\n        />\n        {scaleBy === MARKERS_SCALES.BY_RATING && (\n          <MarkersRatingLevelSelect\n            classes={classes}\n            onClose={closeSidebar}\n            ratingLevel={ratingLevel}\n            onChange={setQueryFilter}\n          />\n        )}\n      </>\n    ),\n    [scaleBy, ratingLevel],\n  );\n\n  return { scaleBy, ratingLevel };\n}\n\nfunction resolveActualScaleBy(scaleByQuery) {\n  return Object.values(MARKERS_SCALES).includes(scaleByQuery)\n    ? scaleByQuery\n    : MARKERS_SCALE_DEFAULT;\n}\nfunction resolveActualRatingLevel(ratingLevelQuery) {\n  return Object.values(MARKERS_RATING_LEVELS).includes(ratingLevelQuery)\n    ? ratingLevelQuery\n    : MARKERS_RATING_LEVEL_DEFAULT;\n}\n","/* globals __GOOGLE_MAP_API_KEY__ */\nimport React, { useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport cls from 'classnames';\nimport GoogleMapReact from 'google-map-react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport locationPropTypes from 'travel/models/locations/propTypes';\nimport visitsPropTypes from 'travel/models/visits/propTypes';\nimport adaptMarkerData from './utils/adaptMarkerData';\nimport filterMarkerData from './utils/filterMarkerData';\nimport makeScaleUtils from './utils/makeScaleUtils';\nimport renderTitle from './utils/renderTitle';\nimport resolveMarkerUrl from './utils/resolveMarkerUrl';\nimport { MARKERS_SCALES, MARKERS_RATING_LEVELS } from './consts';\nimport useMarkers from './useMarkers';\n\nexport { MARKERS_SCALES, MARKERS_RATING_LEVELS };\nexport useMarkersScaleSidebar from './useMarkersScaleSidebar';\n\nconst useStyles = makeStyles({\n  googleMapContainer: {\n    margin: '12px 0',\n    maxWidth: '100%',\n    flexGrow: 1,\n    minHeight: ({ minHeight }) => minHeight,\n    position: 'relative',\n  },\n  googleMapPosition: {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    right: '0',\n    bottom: '0',\n  },\n});\n\nexport default function LocationsMap({\n  className,\n  locationsDict,\n  visitsDict,\n  locationsRating,\n  locationsIds,\n  minHeight,\n  scaleBy,\n  ratingLevel,\n}) {\n  const classes = useStyles({ minHeight });\n  const markersData = useMemo(\n    () => {\n      const adaptedMarkersData = adaptMarkerData({\n        locationsDict,\n        visitsDict,\n        locationsRating,\n        locationsIds,\n      });\n      const actualMarkersData = filterMarkerData(adaptedMarkersData, {\n        ratingLevel,\n      });\n      const { resolveStep, resolveOptions } = makeScaleUtils(scaleBy);\n      const options = resolveOptions && resolveOptions(actualMarkersData);\n      return actualMarkersData.map(markerData => {\n        const step = resolveStep(markerData, options);\n        return {\n          ...markerData,\n          zIndex: [\n            MARKERS_SCALES.BY_RATING,\n            MARKERS_SCALES.BY_FIRST_VISIT,\n          ].includes(scaleBy)\n            ? 10 - step\n            : step,\n          iconUrl: resolveMarkerUrl(step, scaleBy),\n          title: renderTitle(markerData),\n        };\n      });\n    },\n    [\n      locationsDict,\n      visitsDict,\n      locationsRating,\n      locationsIds,\n      scaleBy,\n      ratingLevel,\n    ],\n  );\n  const { handleGoogleApiLoaded } = useMarkers(markersData);\n\n  return (\n    <div className={cls(className, classes.googleMapContainer)}>\n      <div className={classes.googleMapPosition}>\n        <GoogleMapReact\n          bootstrapURLKeys={{ key: __GOOGLE_MAP_API_KEY__ }}\n          center={{ lat: 0, lng: 0 }}\n          zoom={11}\n          onGoogleApiLoaded={handleGoogleApiLoaded}\n        />\n      </div>\n    </div>\n  );\n}\n\nLocationsMap.propTypes = {\n  className: PropTypes.string,\n  visitsDict: PropTypes.objectOf(PropTypes.shape(visitsPropTypes)).isRequired,\n  locationsDict: PropTypes.objectOf(PropTypes.shape(locationPropTypes))\n    .isRequired,\n  locationsIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  locationsRating: PropTypes.objectOf(PropTypes.number).isRequired,\n  minHeight: PropTypes.number,\n  scaleBy: PropTypes.oneOf(Object.values(MARKERS_SCALES)).isRequired,\n  ratingLevel: PropTypes.oneOf(Object.values(MARKERS_RATING_LEVELS)).isRequired,\n};\n\nLocationsMap.defaultProps = {\n  className: undefined,\n  minHeight: '400px',\n};\n","import { MARKERS_RATING_LEVELS } from '../consts';\nimport { LOCATION_RATING } from 'travel/models/users/consts';\n\nexport default function filterMarkerData(adaptedMarkersData, { ratingLevel }) {\n  if (\n    !Object.values(MARKERS_RATING_LEVELS).includes(ratingLevel) ||\n    ratingLevel === MARKERS_RATING_LEVELS.ALL\n  ) {\n    return adaptedMarkersData;\n  }\n  return adaptedMarkersData.filter(({ locationRating, visitsCount }) => {\n    switch (ratingLevel) {\n      case MARKERS_RATING_LEVELS.WANT_COME_BACK:\n        if (visitsCount < 2) {\n          return locationRating <= LOCATION_RATING.TWICE_PER_LIVE;\n        }\n        return locationRating <= LOCATION_RATING.ONCE_PER_DECADE;\n      case MARKERS_RATING_LEVELS.LOVE_THIS_PLACE:\n        return locationRating <= LOCATION_RATING.ONCE_PER_YEAR;\n      default:\n        return true;\n    }\n  });\n}\n"],"sourceRoot":""}