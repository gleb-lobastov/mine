(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{804:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(0),i=n(71),a=n(820),o=n.n(a),c=n(821),s=n.n(c),u=n(834),l=n.n(u),f=n(158),p=n.n(f),_=n(149),O=n(17),b=n(812),v=n(806),d=n(813);function m(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function g(e){var t=e.userAlias,n=function(e){var t=e.userAlias,n=e.tripsIds,r=Object(i.c)((function(e){return{tripsDict:Object(_.c)(e,"trips")||{}}})).tripsDict,a=!n,o=!a&&n.filter((function(e){return!r[e]}));return Object(_.f)({domain:"travel.trips-".concat(t),isProvision:!0,modelName:"trips",observe:t,query:{userAlias:t,navigation:{isDisabled:!0},filter:a?{}:{id:{comparator:"in",value:o}}}})}({userAlias:t,tripsIds:e.tripsIds}),a=Object(b.a)({domain:"travel.trips-".concat(t,".user"),userAlias:t}),c=a.user,s=(c=void 0===c?{}:c).locationsRating,u=void 0===s?{}:s,f=m(a,["user"]),g=(Object(O.o)(n)||{}).data,I=void 0===g?[]:g,T=Object(i.c)((function(e){return{tripsDict:Object(_.c)(e,"trips")||{},visitsDict:Object(_.c)(e,"visits")||{},ridesDict:Object(_.c)(e,"rides")||{},countriesDict:Object(_.c)(e,"countries")||{},locationsDict:Object(_.c)(e,"locations")||{}}})),j=T.tripsDict,A=T.visitsDict,E=T.ridesDict,R=T.countriesDict,N=T.locationsDict,h=Object(r.useMemo)((function(){return Array.from(new Set(I.flatMap((function(e){var t;return(null===(t=j[e])||void 0===t?void 0:t.visits)||[]}))))}),[I,j]),S=Object(r.useMemo)((function(){return Array.from(new Set(I.flatMap((function(e){var t;return(null===(t=j[e])||void 0===t?void 0:t.rides)||[]}))))}),[I,j]),D=Object(r.useMemo)((function(){return Array.from(new Set(h.flatMap((function(e){var t;return(null===(t=A[e])||void 0===t?void 0:t.countryId)||[]}))))}),[h,A]),P=Object(r.useMemo)((function(){return Array.from(new Set(h.flatMap((function(e){var t;return(null===(t=A[e])||void 0===t?void 0:t.locationId)||[]}))))}),[h,A]),w=Object(v.a)(),C=Object(d.a)({domain:"travel.locations-".concat(t),locationsIds:P}),V=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{updatesCounter:l()(t.map(O.p)),isReady:t.every(O.i),isPending:t.some(O.h),isValid:t.every(O.k),error:t.find(O.g),errors:t.map(O.f).filter(Boolean),invalidate:function(){return t.forEach((function(e){return(0,e.invalidate)()}))}}}(n,f,w,C),L=V.isError,B=V.isValid,Y=V.isReady,G=V.isPending,M=function(e,t,n){var r=e.reduce((function(e,r){var i=t[r];if(!i)return e;var a=n[r],o=i.countryId;return e[o]||(e[o]=[]),e[o].push(a),e}),{});return p()(r,(function(e){return function(e){if(!e.length)return 1/0;var t=e.length/e.map((function(e){return 1/e})).reduce((function(e,t){return e+t})),n=o()(e),r=Math.log(e.length);return 1/(1/t+r/n)}(e)}))}(P,N,u);return{tripsProvision:n,countriesProvision:w,locationsProvision:C,isError:L,isValid:B,isReady:Y,isPending:G,tripsIds:I,tripsDict:j,visitsIds:h,visitsDict:A,ridesIds:S,ridesDict:E,ridesStats:y(S,E),locationsIds:P,locationsDict:N,locationsRating:u,countriesIds:D,countriesDict:R,countriesRating:M}}function y(e,t){return{earliestDeparture:new Date(s()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.departureDateTime.getTime()})))),latestArrival:new Date(o()(e.map((function(e){var n;return null===(n=t[e])||void 0===n?void 0:n.arrivalDateTime.getTime()}))))}}},806:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(149);n(17);function i(){return Object(r.f)({domain:"travel.countries",isProvision:!0,modelName:"countries",query:{navigation:{isDisabled:!0}}})}},812:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(71),i=n(149);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=e.domain,n=e.userAlias,c=Object(r.c)((function(e){return Object(i.e)(e,"users",n)}));return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(i.f)({domain:t,applicableSchemaName:"item",isProvision:!0,modelName:"users",observe:n,condition:Boolean(n),query:{id:n}}),{user:c})}},813:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var r=n(71),i=n(149);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){var t=e.domain,n=e.locationsIds,a=Object(r.c)((function(e){return Object(i.c)(e,"locations")||{}})),o=n.filter((function(e){return!a[e]}));return Object(i.f)({domain:t,isProvision:!0,modelName:"locations",observe:n,condition:Boolean(o.length),query:{filter:{id:{comparator:"in",value:o}},navigation:{isDisabled:!0}}})}function u(e){var t=e.domain,n=c(Object(i.g)({domain:t,modelName:"locations",method:"POST"}),2),r=n[0];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n[1],{submitLocationRating:r})}},920:function(e,t,n){"use strict";n.d(t,"b",(function(){return F})),n.d(t,"a",(function(){return Z}));var r=n(0),i=n.n(r),a=n(2),o=n.n(a),c=n(150),s=n.n(c),u=n(1013),l=n.n(u),f=n(791),p=n(279),_=n(237),O=n(821),b=n.n(O),v=n(820),d=n.n(v);function m(e){var t=e.locationsIds,n=e.locationsDict,r=e.visitsDict,i=e.locationsRating;return t.map((function(e){var t=n[e];if(!t)return null;var a=t.lon,o=t.lat,c=t.locationName,s=function(e,t){return e.reduce((function(e,n){var r=t[n];if(r){var i=r.arrivalDateTime,a=r.departureDateTime;e.firstVisitDateTime=b()([e.firstVisitDateTime,i]),e.lastVisitDateTime=d()([e.lastVisitDateTime,a])}return e}),{firstVisitDateTime:null,lastVisitDateTime:null})}(t.visitsIds,r);return{locationName:c,lat:o,lon:a,firstVisitDateTime:s.firstVisitDateTime,lastVisitDateTime:s.lastVisitDateTime,locationRating:i[e],visitsCount:t.visitsIds.length}}))}var g,y=n(232);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T={BY_FIRST_VISIT:"fv",BY_LAST_VISIT:"lv",BY_VISITS_COUNT:"vc",BY_RATING:"r"},j=T.BY_FIRST_VISIT,A=["step_by_time_1_zjtrlw.png","step_by_time_2_tvotvg.png","step_by_time_3_ylj1vi.png","step_by_time_4_uovfrs.png","step_by_time_5_s4jq0u.png","step_by_time_6_lmihnf.png"],E=(I(g={},T.BY_FIRST_VISIT,A),I(g,T.BY_LAST_VISIT,A),I(g,T.BY_VISITS_COUNT,["step_by_visits_1_zv3tba.png","step_by_visits_2_qthjqa.png","step_by_visits_3_xcjyla.png","step_by_visits_4_kwdwka.png","step_by_visits_5_xnnipa.png"]),I(g,T.BY_RATING,["step_by_rating_1_id2qgb.png","step_by_rating_2_iiqvik.png","step_by_rating_3_x2gzsd.png","step_by_rating_4_cbqdcn.png","step_by_rating_5_viyhls.png","step_by_rating_6_zzfgki.png","step_by_rating_7_pjjhhq.png","step_by_rating_8_vgetsd.png","step_by_rating_9_t6tenz.png","step_by_rating_10_yjywr0.png"]),g);function R(e){var t=e.visitsCount;switch(!0){case t>10:return 5;case t>5:return 4;case t>2:return 3;case t>1:return 2;default:return 1}}function N(e){switch(e.locationRating){case y.LOCATION_RATING.PLACE_TO_LIVE:return 1;case y.LOCATION_RATING.FEW_PER_YEAR:case y.LOCATION_RATING.ONCE_PER_YEAR:return 3;case y.LOCATION_RATING.ONCE_PER_TWO_YEARS:case y.LOCATION_RATING.ONCE_PER_FIVE_YEARS:return 4;case y.LOCATION_RATING.ONCE_PER_DECADE:case y.LOCATION_RATING.TWICE_PER_LIVE:return 7;case y.LOCATION_RATING.ONCE_PER_LIVE:return 9;case y.LOCATION_RATING.NEVER:return 10;default:return 6}}function h(e){return{resolveStep:function(t,n){var r=(t[e]-n.minTime)/n.diff*6;return Math.min(Math.max(Math.floor(r),0),6)},resolveOptions:function(t){var n=t.map((function(t){return t[e]&&t[e].getTime()})).filter(Boolean),r=b()(n);return{minTime:r,diff:d()(n)+1-r}}}}var S=n(819),D=n.n(S),P=n(55);function w(e){return Object(P.a)(e,"eeeeee, d MMMM yyyy",{locale:D.a})}function C(e){switch(e){case y.LOCATION_RATING.PLACE_TO_LIVE:return"*****";case y.LOCATION_RATING.FEW_PER_YEAR:case y.LOCATION_RATING.ONCE_PER_YEAR:return"****";case y.LOCATION_RATING.ONCE_PER_TWO_YEARS:case y.LOCATION_RATING.ONCE_PER_FIVE_YEARS:return"***";case y.LOCATION_RATING.ONCE_PER_DECADE:case y.LOCATION_RATING.TWICE_PER_LIVE:return"**";case y.LOCATION_RATING.ONCE_PER_LIVE:return"*";case y.LOCATION_RATING.NEVER:return"-";default:return"?"}}function V(e,t){var n=E[t],r=n[e-1]||n[0];return"".concat("https://res.cloudinary.com/dc2eke0gj/image/upload/markers/").concat(r)}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var B=n(795),Y=n(796),G=n(1085),M=n(1110),k=n(1102),x=n(1088),q=n(199);var z=Object(f.a)({formControl:{width:"100%"}}),F=function(e,t){var n=z(),r=function(e){return Object.values(T).includes(e)?e:j}((t||{}).scale);return Object(q.b)((function(t){var a=t.closeSidebar;return i.a.createElement(B.a,null,i.a.createElement(Y.a,null,i.a.createElement(G.a,{className:n.formControl},i.a.createElement(M.a,{shrink:!0,id:"select-groupBy-filter-label"},"Раскрасить маркеры"),i.a.createElement(k.a,{labelId:"select-groupBy-filter-label",autoWidth:!0,id:"select-groupBy-filter",value:r,onChange:function(t){var n,r,i;a(),e((n={},r="scale",i=t.target.value,r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n))}},i.a.createElement(x.a,{key:T.BY_FIRST_VISIT,value:T.BY_FIRST_VISIT},"По первому посещению"),i.a.createElement(x.a,{key:T.BY_LAST_VISIT,value:T.BY_LAST_VISIT},"По последнему посещению"),i.a.createElement(x.a,{key:T.BY_VISITS_COUNT,value:T.BY_VISITS_COUNT},"По числу посещений"),i.a.createElement(x.a,{key:T.BY_RATING,value:T.BY_RATING},"По рейтингу")))))}),[r]),{scaleBy:r}};function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=Object(f.a)({googleMapContainer:{margin:"12px 0",maxWidth:"100%",flexGrow:1,minHeight:function(e){return e.minHeight},position:"relative"},googleMapPosition:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}});function Z(e){var t=e.className,n=e.locationsDict,a=e.visitsDict,o=e.locationsRating,c=e.locationsIds,u=e.minHeight,f=e.scaleBy,p=H({minHeight:u}),_=function(e){var t=L(Object(r.useState)(null),2),n=t[0],i=t[1],a=Object(r.useRef)(!0);return Object(r.useEffect)((function(){if(n){var t=n.map,r=n.maps,i=new r.LatLngBounds,o=e.map((function(e){var n=e.lat,a=e.lon,o=e.iconUrl,c=e.title,s=e.zIndex,u=new r.Marker({map:t,position:{lat:n,lng:a},icon:{url:o,scaledSize:new r.Size(24,24)},scale:.5,title:c,zIndex:s});return i.extend(u.position),u}));return a.current&&(t.setOptions({maxZoom:11,minZoom:2}),t.fitBounds(i),t.setOptions({maxZoom:null,minZoom:null}),a.current=!1),function(){o.forEach((function(e){e.setMap(null),e.setVisible(!1)})),o.length=0}}}),[n,e]),{handleGoogleApiLoaded:function(e){return i(e)}}}(Object(r.useMemo)((function(){var e=m({locationsDict:n,visitsDict:a,locationsRating:o,locationsIds:c}),t=function(e){switch(e){case T.BY_VISITS_COUNT:return{resolveStep:R};case T.BY_RATING:return{resolveStep:N};case T.BY_LAST_VISIT:return h("lastVisitDateTime");case T.BY_FIRST_VISIT:default:return h("firstVisitDateTime")}}(f),r=t.resolveStep,i=t.resolveOptions,s=i&&i(e);return e.map((function(e){var t,n,i,a,o,c,u=r(e,s);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){U(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{zIndex:[T.BY_RATING,T.BY_FIRST_VISIT].includes(f)?10-u:u,iconUrl:V(u,f),title:(t=e,n=t.locationName,i=t.locationRating,a=t.visitsCount,o=t.firstVisitDateTime,c=t.lastVisitDateTime,[n,"Посещено ".concat(a," раз"),"Впервые ".concat(w(o)),a>1&&"Прошлое посешение ".concat(w(c)),"Рейтинг: ".concat(C(i))].filter(Boolean).join("\n"))})}))}),[n,a,o,c,f])).handleGoogleApiLoaded;return i.a.createElement("div",{className:s()(t,p.googleMapContainer)},i.a.createElement("div",{className:p.googleMapPosition},i.a.createElement(l.a,{bootstrapURLKeys:{key:"AIzaSyCvP0e64ui7WpXKBdzOyEmkb4l5RuGy3Zs"},center:{lat:0,lng:0},zoom:11,onGoogleApiLoaded:_})))}Z.propTypes={className:o.a.string,visitsDict:o.a.objectOf(o.a.shape(_.default)).isRequired,locationsDict:o.a.objectOf(o.a.shape(p.default)).isRequired,locationsIds:o.a.arrayOf(o.a.number).isRequired,locationsRating:o.a.objectOf(o.a.number).isRequired,minHeight:o.a.number,scaleBy:o.a.oneOf(Object.values(T)).isRequired},Z.defaultProps={className:void 0,minHeight:"400px"}}}]);
//# sourceMappingURL=travel-Dashboard~travel-LocationsPage-db6202501ab29711f149.js.map